KISSY.add("json",function(S){if(S.JSON&&S.JSON.parse){return false}var JSON=S.JSON=window.JSON||{};function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}});KISSY.add("swf-ua",function(b){function a(){var f=0,h="ShockwaveFlash",g=navigator.mimeTypes["application/x-shockwave-flash"],i,d;if(g){if((d=g.enabledPlugin)){f=c(d.description.replace(/\s[rd]/g,".").replace(/[a-z\s]+/ig,"").split("."))}}else{try{i=new ActiveXObject(h+"."+h+".6");i.AllowScriptAccess="always"}catch(j){if(i!==null){f=6}}if(f===0){try{f=c(new ActiveXObject(h+"."+h)["GetVariable"]("$version").replace(/[A-Za-z\s]+/g,"").split(","))}catch(j){}}}return parseFloat(f)}function c(d){var e=d[0]+".";switch(d[2].toString().length){case 1:e+="00";break;case 2:e+="0";break}return(e+=d[2])}b.UA.flash=a()});KISSY.add("swf",function(d){var g=d.UA,e=d.now(),j=10.22,b="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000",f="application/x-shockwave-flash",a="http://fpdownload.macromedia.com/pub/flashplayer/update/current/swf/autoUpdater.swf?"+e,c="KISSY.SWF.eventHandler",h={align:"",allowNetworking:"",allowScriptAccess:"",base:"",bgcolor:"",menu:"",name:"",quality:"",salign:"",scale:"",tabindex:"",wmode:""};function i(m,r,q){var y=this,k="ks-swf-"+e++,l=parseFloat(q.version)||j,v=g.flash>=l,u=g.flash>=8,o=u&&q.useExpressInstall&&!v,x=(o)?a:r,n="YUISwfId="+k+"&YUIBridgeCallback="+c,t="<object ";y.id=k;i.instances[k]=y;if((m=d.get(m))&&(v||o)&&x){t+='id="'+k+'" ';if(g.ie){t+='classid="'+b+'" '}else{t+='type="'+f+'" data="'+x+'" '}t+='width="100%" height="100%">';if(g.ie){t+='<param name="movie" value="'+x+'"/>'}for(var s in q.fixedAttributes){if(h.hasOwnProperty(s)){t+='<param name="'+s+'" value="'+q.fixedAttributes[s]+'"/>'}}for(var w in q.flashVars){var p=q.flashVars[w];if(typeof p==="string"){n+="&"+w+"="+encodeURIComponent(p)}}t+='<param name="flashVars" value="'+n+'"/>';t+="</object>";m.innerHTML=t;y.swf=d.get("#"+k)}}i.instances=(d.SWF||{}).instances||{};i.eventHandler=function(k,l){i.instances[k]._eventHandler(l)};d.augment(i,d.EventTarget);d.augment(i,{_eventHandler:function(m){var k=this,l=m.type;if(l==="log"){d.log(m.message)}else{if(l){setTimeout(function(){k.fire(l,m)},100)}}},callSWF:function(m,l){var k=this;if(k.swf[m]){return k.swf[m].apply(k.swf,l||[])}}});d.SWF=i});KISSY.add("swfstore",function(c,g){var e=c.UA,b=c.Cookie,d="swfstore",f=document;function a(n,h,l,m){var j="other",k=b.get(d),o,i=this;l=(l!==g?l:true)+"";m=(m!==g?m:true)+"";if(e.ie){j="ie"}else{if(e.gecko){j="gecko"}else{if(e.webkit){j="webkit"}else{if(e.opera){j="opera"}}}}if(!k||k==="null"){b.set(d,(k=Math.round(Math.random()*Math.PI*100000)))}o={version:9.115,useExpressInstall:false,fixedAttributes:{allowScriptAccess:"always",allowNetworking:"all",scale:"noScale"},flashVars:{allowedDomain:f.location.hostname,shareData:l,browser:k,useCompression:m}};if(!h){h=f.body.appendChild(c.DOM.create('<div style="height:0;width:0;overflow:hidden"></div>'))}i.embeddedSWF=new c.SWF(h,n||"swfstore.swf",o);i.embeddedSWF._eventHandler=function(p){c.SWF.prototype._eventHandler.call(i,p)}}c.augment(a,c.EventTarget);c.augment(a,{setItem:function(h,i){if(typeof i==="string"){i=i.replace(/\\/g,"\\\\")}else{i=c.JSON.stringify(i)+""}if((h=c.trim(h+""))){try{return this.embeddedSWF.callSWF("setItem",[h,i])}catch(j){this.fire("error",{message:j})}}},getItem:function(h){try{return this.embeddedSWF.callSWF("getValueOf",[h])}catch(i){}}});c.each(["getValueAt","getNameAt","getValueOf","getItems","getLength","removeItem","removeItemAt","clear","calculateCurrentSize","hasAdequateDimensions","setSize","getModificationDate","displaySettings"],function(h){a.prototype[h]=function(){try{return this.embeddedSWF.callSWF(h,c.makeArray(arguments))}catch(i){this.fire("error",{message:i})}}});c.SWFStore=a});KISSY.add("dragdrop",function(c){var n=c.Event,o=c.DOM,k=document,f=window,h={axis:0,region:false,handle:false,not:false,revert:false,snap:false,scroll:false,lock:false,circular:false,multi:false,resize:false,proxy:false,delay:false,resizefn:false,cursor:false},m=false,d=function(s,q){var r=s;var s=c.makeArray(c.query(s)),p=this,q=c.merge(h,q||{});c.each(s,function(t){p._init(t,q,r)})},a=function(r,q,p){return(r>p?p:r<q?q:r)},g=function(r){var p=o.css(r,"position"),q;if(p.toLowerCase()=="absolute"){q=[r.offsetLeft,r.offsetTop]}else{if(p.toLowerCase()=="relative"){q=[parseInt(o.css(r,"left"))||0,parseInt(o.css(r,"top"))||0]}}return q},b=function(s,r,t,v,q){if(t.toLowerCase()==="left"){var u="offsetWidth",x=3,w=1;if(c.UA.ie){u="clientWidth"}}else{var u="offsetHeight",x=0,w=2,p="clientHeight";if(c.UA.ie){u="clientHeight"}}if(r.region){num=a(parseInt(s.style[t])+v,r.region[x],r.region[w])}else{num=parseInt(s.style[t])+v}return num},e=function(q,p,r){if(p.toLowerCase()==="left"){if(c.UA.ie){num=a(parseInt(q.style[p])+r,0,c.DOM.viewportWidth()-q.clientWidth-2)}else{num=a(parseInt(q.style[p])+r,0,c.DOM.viewportWidth()-q.clientWidth-2-17)}}else{num=a(parseInt(q.style[p])+r,parseInt(q.style[p])-parseInt(o.offset(q).top)+(k.documentElement.scrollTop||k.body.scrollTop),99999)}return num},i=function(r,q){if(c.isArray(q)){for(var p=0;p<q.length;p++){if(o.hasClass(r,q[p].substr(1))){return true}}}else{if(o.hasClass(r,q.substr(1))){return true}}},l=function(q){var p=q.cloneNode(true);k.body.appendChild(p);return p};setRegion=function(p,q){q[0]=parseInt(o.css(p,"top"))-q[0];q[1]=parseInt(o.css(p,"left"))+q[1];q[2]=parseInt(o.css(p,"top"))+q[2];q[3]=parseInt(o.css(p,"left"))-q[3];return q};c.augment(d,{_init:function(F,G,t){var C,B,x,v,D=false,E=false,u=this,w=false,y=G.snap,A=[0,0];(function(){var I=false;if(c.isString(G.region)&&G.region.toLowerCase()!="scroll"){var J=o.get(G.region);G.region=[o.offset(F).top-o.offset(J).top,(o.offset(J).left+J.offsetWidth)-(o.offset(F).left+F.offsetWidth),(o.offset(J).top+J.offsetHeight)-(o.offset(F).top+F.offsetHeight),o.offset(F).left-o.offset(J).left];I=true}else{if(c.isString(G.region)&&G.region.toLowerCase()=="scroll"){G.region=[o.offset(F).top,k.documentElement.clientWidth-o.offset(F).left-F.offsetWidth,k.documentElement.clientHeight-o.offset(F).top-F.offsetHeight,o.offset(F).left];I=true}else{if(G.region.length==4&&c.isArray(G.region)){}}}if(I){setRegion(F,G.region)}I=false})();if(G.circular){var s=g(F,G)[0]+G.circular+30,r=g(F,G)[1]+30}var p=function(I){if(G.islock){m=true}if(G.not&&i(I.target,G.not)){return}w=true;A=g(F);x=I.clientX;v=I.clientY;if(!D&&G.proxy){E=F;D=l(F);F=D}o.css(F,"left",A[0]+"px");o.css(F,"top",A[1]+"px");if(G.cursor){o.css(F,"cursor",G.cursor)}u.onStartDrag&&u.onStartDrag(I,F,G)},q=function(L){if(!w||u.isLock(G)){return}C=L.clientX-x;B=L.clientY-v;if(G.circular){angle=Math.atan2(L.clientX-s,L.clientY-r);o.css(F,"left",s+Math.sin(angle)*G.circular-30+"px");o.css(F,"top",r+Math.cos(angle)*G.circular-30+"px")}else{if(G.snap){o.css(F,"left",parseInt(F.style.left)+Math.round(C/y[0])*y[0]+"px");o.css(F,"top",parseInt(F.style.top)+Math.round(B/y[1])*y[1]+"px");x=x+Math.round(C/y[0])*y[0];v=v+Math.round(B/y[1])*y[1]}else{if(G.resize){var I=parseInt(o.css(F,"width")),K=parseInt(o.css(F,"height"));if(G.resizefn[0]){if(Math.max(20,I+C)>G.resizefn[0]){if(C>0&&(L.clientX<=parseInt(o.offset(F).left)+I)){C=0}o.css(F,"width",Math.max(20,I+C)+"px")}}if(G.resizefn[1]){if(Math.max(20,K+B)>G.resizefn[1]){if(B>0&&(parseInt(L.clientY)<=parseInt(o.offset(F).top)+K-parseInt(k.documentElement.scrollTop||k.body.scrollTop))){B=0}else{o.css(F,"height",Math.max(20,K+B)+"px")}}}x=L.clientX;v=L.clientY}else{if(G.scroll){if(G.axis!="y"){o.css(F,"left",e(F,"left",C)+"px")}if(G.axis!="x"){o.css(F,"top",e(F,"top",B)+"px")}x=L.clientX;v=L.clientY}else{if(G.multi&&o.hasClass(F,"ks-multi")){var J=c.makeArray(c.query(".ks-multi"));if(J==0){J=[F]}}else{J=[F]}c.each(J,function(M){if(G.axis!="y"){o.css(M,"left",b(M,G,"left",C,A)+"px")}if(G.axis!="x"){o.css(M,"top",b(M,G,"top",B,A)+"px")}});x=L.clientX;v=L.clientY}}}}if(c.UA.chrome){n.on(document,"selectstart",function(M){M.halt()})}f.getSelection?f.getSelection().removeAllRanges():k.selection.empty();u.onDrag&&u.onDrag(L,F,G,C,B,t)},H=function(I){if(w!=true){return}w=false;n.remove(k,"mousemove",q);f.getSelection?f.getSelection().removeAllRanges():k.selection.empty();if(D&&G.proxy){o.css(E,"left",parseInt(D.style.left)+"px");o.css(E,"top",parseInt(D.style.top)+"px");F=E;D.parentNode.removeChild(D);D=false;E=false}if(G.revert){o.css(F,"left",A[0]+"px");o.css(F,"top",A[1]+"px")}if(G.cursor){o.css(F,"cursor","default")}u.onEndDrag&&u.onEndDrag(I,F,G);if(c.UA.chrome){n.remove(document,"selectstart")}},z=function(I){if(!o.hasClass(F,"ks-multi")){o.addClass(F,"ks-multi")}else{o.removeClass(F,"ks-multi")}};n.add(c.get(G.handle,F)||F,"mousedown",function(I){p(I);n.add(k,"mousemove",q)});n.add(k,"mouseup",H);if(G.multi){n.add(F,"dblclick",z)}},onStartDrag:null,onDrag:null,onEndDrag:null,isLock:function(){return m}});c.Drag=d;function j(u,s,p,w,r,q,v,t){if(r>=p||q>=w||v<=u||t<=s){return false}else{return true}}c.Drag.intersectRect=j});KISSY.add("kissy-ua-cn",function(c){var b=navigator.userAgent,a,g={safe:0,sogo:0,tt:0,maxthon:0},d=function(e){var h=0;return parseFloat(e.replace(/\./g,function(){return(h++===0)?".":""}))};if(!((a=b.match(/AppleWebKit\/([\d.]*)/))&&a[1])){if((a=b.match(/MSIE\s([^;]*)/))&&a[1]){g.ie=d(a[1]);if((a=b.match(/360SE/))){g.safe="360SE"}if((a=b.match(/SE\s([^;]*)/))&&a[1]){g.sogo=d(a[1])}if((a=b.match(/TencentTraveler\s([^;]*)/))&&a[1]){g.tt=d(a[1])}try{if(window.external&&window.external.max_version){g.maxthon=d(window.external.max_version).toFixed(1)}}catch(f){}}}c.CNUA=g});KISSY.app("TStart",function(){var a=KISSY,c=document,b=0;return{version:"1.0",plugins:[],addPlugin:function(f,g){var d=this.plugins,e=d.length;a.each(a.makeArray(f),function(h){if(h===""){d[e++]={type:TStart.PLUGIN_TYPE.SEPARATOR,area:g.area}}else{d[e++]=a.merge(g,{name:h})}})},addStyleSheet:function(f){var e=a.get("head"),d;if(/\.css$/.test(f)){d=c.createElement("link");d.setAttribute("rel","stylesheet");d.href=f;e.appendChild(d)}else{a.DOM.addStyleSheet(f)}},EVENTS:{MINIMIZED:"Minimized",MAXIMIZED:"Maximized"},IO:{getScript:a.IO?a.IO.getScript:(a.getScript?a.getScript:a.Ajax.getScript),jsonp:function(d,g){var e=this,f;if(!a.isString(g)){f="_jsonp_"+b++;e[f]=g;f="TStart.IO."+f}else{f=g}e.getScript(d+(d.indexOf("?")>-1?"&":"?")+"callback="+f)}}}});TStart.add("core~plugin-manager",function(c){var d=KISSY,q=d.DOM,r=d.Event,s=document,h={CUSTOM:0,SEPARATOR:1,LINK:2,DROP_ITEM:4,NORMAL_ITEM:5},k={0:'<span class="tstart-item tstart-custom-item" id="tstart-plugin-{name}">{html}</span>',1:'<s class="tstart-item tstart-sep-item tstart-sep-item-{name}"></s>',2:'<span class="tstart-item tstart-link-item" id="tstart-plugin-{name}"><s class="tstart-item-icon"></s><a href="{href}" target="{target}">{text}</a>{TIPS}</span>',4:'<span class="tstart-item tstart-drop-item" id="tstart-plugin-{name}"><span class="tstart-drop-trigger"><s class="tstart-item-icon"></s>{text}</span>{DROP_PANEL}{TIPS}</span>',5:'<span class="tstart-item tstart-normal-item" id="tstart-plugin-{name}"><span class="tstart-normal-trigger"><s class="tstart-item-icon"></s>{text}</span>{NORMAL_PANEL}{TIPS}</span>'},g='<span class="tstart-item-tips tstart-item-hover-tips">{tips}<s></s></span>',l=(d.UA.ie?'<div class="tstart-drop-panel">':'<div class="tstart-drop-panel">')+'<div class="tstart-drop-panel-hd"><span>{panelTitle}</span><s class="tstart-drop-panel-clearbtn"></s><s class="tstart-drop-panel-closebtn"><img src="http://img01.taobaocdn.com/tps/i1/T1R6pOXoRyXXXXXXXX-15-15.png"></s></div><div class="tstart-drop-panel-bd tstart-panel-loading" style="width:{panelWidth}px;height:{panelHeight}px"></div></div>',n='<div class="tstart-normal-panel"><div class="tstart-normal-panel-hd"><span>{panelTitle}</span><s class="tstart-normal-panel-clearbtn"></s><s class="tstart-normal-panel-closebtn"><img src="http://img04.taobaocdn.com/tps/i4/T1R2V_XghcXXXXXXXX-15-15.png" /></s></div><div class="tstart-normal-panel-bd tstart-panel-loading" style="width:{panelWidth}px;height:{panelHeight}px"></div></div>',p="tstart-item-active",i="tstart-panel-loading",j=c.plugins,m=[],a=[],o;c.PluginManager={init:function(){d.each(j,function(t){t.html=b(t);if(t.area==="left"){m.push(t)}else{a.push(t)}})},initPlugins:function(){d.each(j,function(u){u.domEl=d.get("#tstart-plugin-"+u.name);if(u.type===h.DROP_ITEM){f(u)}if(u.type===h.NORMAL_ITEM){e(u)}if(u.init){try{u.init()}catch(t){d.error(t)}}})},getAreaHTML:function(u){var v="",t=u==="right"?a:m;d.each(t,function(w){v+=w.html});return v}};function b(v){var u=v.type,t=k[u];if(u===h.SEPARATOR){return t.replace("{name}",v.name||"normal")}if(d.isFunction(v.html)){return v.html()}if(v.tips){t=t.replace("{TIPS}",g)}if(u===h.DROP_ITEM){t=t.replace("{DROP_PANEL}",l)}if(u===h.NORMAL_ITEM){t=t.replace("{NORMAL_PANEL}",n)}return t.replace(/\{([^}]+)\}/g,function(w,x){return v[x]||""})}function e(z){var x=z.domEl,y=d.get(".tstart-normal-panel-closebtn",x),v=d.get(".tstart-normal-panel-clearbtn",x),u=d.get(".tstart-normal-panel-bd",x);r.on(x,"click",function(B){B.halt();if(q.hasClass("#tstart-plugin-settings",p)){q.removeClass("#tstart-plugin-settings",p)}if(q.parent(B.target,"#tstart-plugin-trace-item")){var A=d.get("#tstart-plugin-trace-item"),C=unescape((d.Cookie.get("_nk_")||"").replace(/\\u/g,"%u"));if(!C){Light._openTBLoginPopup();return}}if(z.beforeOpenPanel){if(z.beforeOpenPanel(B)===false){return}}if(o&&o!==this){t()}q.toggleClass(this,p);if(q.hasClass(this,p)){o=this;if(z.onOpenPanel){z.onOpenPanel({container:u,removeLoading:w})}}else{t()}});r.on(d.get(".tstart-normal-panel",x),"click",function(A){A.stopPropagation()});r.on([y,s],"click",t);function t(){if(o){q.removeClass(o,p);o=null}}function w(){q.removeClass(u,i)}}function f(z){var x=z.domEl,y=d.get(".tstart-drop-panel-closebtn",x),v=d.get(".tstart-drop-panel-clearbtn",x),u=d.get(".tstart-drop-panel-bd",x);r.on(x,"click",function(A){A.halt();if(q.hasClass("#tstart-plugin-settings",p)){q.removeClass("#tstart-plugin-settings",p)}if(z.beforeOpenPanel){if(z.beforeOpenPanel(A)===false){return}}if(o&&o!==this){t()}q.toggleClass(this,p);if(q.hasClass(this,p)){o=this;if(z.onOpenPanel){z.onOpenPanel({container:u,removeLoading:w})}}else{t()}});r.on(v,"click",function(){TDog.WebServer.clearChatList();d.get("#tstart .tdog-recentlist").innerHTML='<ul><p class="tdog-recentlist-none">\u6682\u65e0\u8054\u7cfb\u4eba</p></ul>';q.addClass(d.get(".tstart-drop-panel-clearbtn",TDog.hostEl),"hidden")});r.on(d.get(".tstart-drop-panel",x),"click",function(A){A.stopPropagation()});r.on([y,s],"click",t);function t(){if(o){q.removeClass(o,p);o=null}}function w(){q.removeClass(u,i)}}c.PLUGIN_TYPE=h});TStart.add("core~container",function(c){var d=KISSY,e=d.DOM,b=d.Event,g=document,a=d.Cookie.get("x"),f='<div id="tstart"><div class="tstart-toolbar"><div class="tstart-bd"><s class="tstart-line-s1"></s><s class="tstart-line-s2"></s><div class="tstart-areas"><div class="tstart-left-area">{LEFT_ITEMS}</div><div class="tstart-right-area">{RIGHT_ITEMS}</div></div></div></div></div>',h=null;c.Container={init:function(){this._render();this._fix()},_render:function(){var i=c.PluginManager;g.body.appendChild(e.create(f.replace("{LEFT_ITEMS}",i.getAreaHTML("left")).replace("{RIGHT_ITEMS}",i.getAreaHTML("right"))))},_fix:function(){if(d.UA.ie===6){d.each(d.query("#tstart span.tstart-item"),function(i){b.on(i,"mouseenter mouseleave",function(){e.toggleClass(i,"tstart-item-hover")})});b.on(window,"scroll resize",function(){var i=e.get("#tstart");if(i){if(h){clearTimeout(h)}h=setTimeout(function(){i.style.top=e.scrollTop()+e.viewportHeight()-28+"px"},100)}})}}};KISSY.mix(c.Container,KISSY.EventTarget)});TStart.add("core~config",function(i){var j=KISSY,d=j.Cookie,g,e="x",c={e:0,p:"*",s:0,c:0},b=(function(){var m=location.hostname;if(m.indexOf("tmall.com")>0){m="tmall.com"}else{if(m.indexOf("tmall.net")>0){m="tmall.net"}else{m=location.hostname.indexOf("taobao.com")>0?"taobao.com":"taobao.net"}}return m})(),f=/daily/i,a=!(f.test(location.host)),k="http://a.tbcdn.cn/p/tstart/1.0/",l=i.EVENTS;if(!a){k="http://assets.daily.taobao.net/p/tstart/1.0/"}i.Config={init:function(){var m=this;g=i.Container;m._cookie()},isOnline:a,DOMAIN:b,ASSETS_URL:k,_cookie:function(){g.on(l.MAXIMIZED,function(){c=j.merge(c,j.unparam(d.get(e)));c.s=1;h()});g.on(l.MINIMIZED,function(){c=j.merge(c,j.unparam(d.get(e)));c.s=0;h()})}};function h(){d.set(e,j.param(c),365,b,"/")}});TStart.add("core~init",function(a){var b=KISSY;a.init=function(){b.log("\u5f00\u59cb\u521d\u59cb\u5316\u6dd8\u5b9d\u5de5\u5177\u6761");var c=a.PluginManager;a.Config.init();c.init();a.Container.init();c.initPlugins()}});TStart.add("plugin~switch",function(a){var b=KISSY,h=b.DOM,f=b.Event,d=a.PLUGIN_TYPE,e=a.EVENTS,i="tstart-minimized",j=["",""],c=["\u5c55\u5f00\u5de5\u5177\u6761","\u6536\u8d77\u5de5\u5177\u6761"],g=b.Cookie.get("_nk_")||"";a.addPlugin(["switch"],{type:a.PLUGIN_TYPE.CUSTOM,area:"right",html:'<s class="tstart-item-icon" title="\u5c55\u5f00\u5de5\u5177\u6761"></s>',tips:c[0],text:j[0],init:function(){var u=this,s=a.store,q=b.get("#tstart"),k=0,r=b.get("a",u.domEl),o=b.get(".tstart-item-icon",u.domEl),l=a.Container,n="TSTART_STATUS_"+g,p=b.UA.flash&&b.UA.flash>9.1,t;t=function(){var v=g?1:0;if(p){v=s.getItem(n)||v}if(0==v||!v){h.addClass(q,i);h.attr(o,"title",c[0])}else{h.removeClass(q,i);h.attr(o,"title",c[1])}b.log("switch: \u5b58\u50a8\u72b6\u6001\u4e3a: "+v);f.on(h.children(u.domEl)[0],"click",function(x){x.preventDefault();var w=g?1:0;if(h.hasClass(q,i)){h.removeClass(q,i);l.fire(e.MAXIMIZED);h.attr(o,"title",c[1]);w=1}else{h.addClass(q,i);l.fire(e.MINIMIZED);h.attr(o,"title",c[0]);w=0}p&&s.setItem(n,w)});h.html(o,c[h.hasClass(q,i)?0:1])};if(p){b.log("switch: \u652f\u6301 flash");try{a.store.on("contentReady",t)}catch(m){b.log("switch: flash \u51fa\u9519.")}}else{b.log("switch: \u4e0d\u652f\u6301 flash");t()}}})});TStart.add("plugin~search",function(b){var c=KISSY,d=c.DOM,a=c.Event,e=document,f=b.PLUGIN_TYPE;b.addPlugin(["help",""],{type:f.LINK,area:"right",text:"\u6709\u95ee\u5fc5\u7b54",href:"http://service.taobao.com/support/minerva/minerva_ask.htm?minervasource=200&tracelog=toolda",target:"_blank",init:function(){c.Event.on("#tstart-plugin-help","click",function(){new Image().src="http://www.atpanel.com/jsclick?tracelog=toolda&cache="+Math.random()})}})});TStart.add("plugin~trace",function(a){var b=KISSY,e=a.PLUGIN_TYPE,d=['<i class="tip-new"></i><a href="#">\u6dd8\u8db3\u8ff9</a>'],c=["\u6dd8\u8db3\u8ff9"];b.each(["trace-item",""],function(f,g){a.addPlugin(f,{type:e.NORMAL_ITEM,area:"right",text:d[g/2],panelTitle:c[g/2],panelWidth:471,panelHeight:154,onOpenPanel:function(h){a.Trace.loadContent(h,g/2);new Image().src="http://www.atpanel.com/jsclick?cache="+new Date().getTime()+"&tracelog=toolbarfootmark"}})})});TStart.add("trace",function(c){var d=KISSY,w=d.DOM,B=d.Event,k=d.SWFStore;var b=d.Cookie.get("_nk_");var t=["Item","Shop","Search"];var x=["T_recentViewedItem_"+b,"T_recentViewedShop_"+b,"T_recentViewedSearch_"+b];var y=TStart.Config.ASSETS_URL+"plugins/trace/swfstore.swf?t=20100629";var g=new k(y);try{g.on("contentReady",function(){g.isReady=true})}catch(v){d.log("trace: flash \u62a5\u9519, \u65e0\u6cd5\u5b8c\u6210 contentReady.")}var z=[];var r="\u222b\u221d";var j="|";var s=[6,6,15];var A="http://img08.taobaocdn.com/tps/i8/T1zipAXmdAXXXXXXXX-60-60.png";var l=['<p class="title">\u4e0d\u77e5\u9053\u8981\u770b\u4ec0\u4e48?</p><p><i class="dot">\u00b7</i>\u53bb <a href="http://list.taobao.com/browse/cat-0.htm" target="_blank">\u6211\u8981\u4e70</a> \u770b\u770b\u5b9d\u8d1d</p><p><i class="dot">\u00b7</i>\u53bb <a href="http://cuxiao.taobao.com/" target="_blank">\u4fc3\u9500\u9891\u9053</a> \u770b\u770b\u6700\u8fd1\u7684\u6d3b\u52a8</pl>','<p class="title">\u4e0d\u77e5\u9053\u8981\u770b\u4ec0\u4e48?</p><p><i class="dot">\u00b7</i>\u53bb <a href="http://www.taobao.com/go/chn/store/index.php" target="_blank">\u5e97\u94fa\u8857</a> \u770b\u770b\u6dd8\u5b9d\u597d\u5e97</p>','<p>\u60a8\u5728\u7535\u8111\u4e0a\u5c1a\u672a\u4f7f\u7528\u8fc7<a href="http://search.taobao.com/" target="_blank">\u6dd8\u5b9d\u641c\u7d22</a>!</p>'];var u=["trace-panel-item","trace-panel-shop","trace-panel-search"];var n=["\u5220\u9664\u5b9d\u8d1d\u6d4f\u89c8\u8bb0\u5f55","\u5220\u9664\u5e97\u94fa\u6d4f\u89c8\u8bb0\u5f55","\u5220\u9664\u641c\u7d22\u4f7f\u7528\u8bb0\u5f55"];var i="vb-hidden";var h="trace-page";var f='<div class="record-empty">\u60a8\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301 flash, \u6682\u65f6\u4e0d\u80fd\u4f7f\u7528\u6dd8\u8db3\u8ff9\u529f\u80fd<br /><a href="http://get.adobe.com/flashplayer/" target="_blank">\u4e0b\u8f7d\u5b89\u88c5 Flash</a></div>';var q='<ul class="tab"><li class="tstart-plugin-trace-item-li selected"><a>\u6d4f\u89c8\u8fc7\u7684\u5b9d\u8d1d</a></li><li class="tstart-plugin-trace-shop-li"><a>\u901b\u8fc7\u7684\u5e97\u94fa</a></li><li class="tstart-plugin-trace-key-li"><a>\u7528\u8fc7\u7684\u641c\u7d22\u5173\u952e\u5b57</a></li></ul>';function a(e){if(g.getItem(e)){return g.getItem(e)}return""}function p(e,C){g.setItem(e,C)}function m(e){return e.split(r)}function o(e){if(typeof e=="undefined"){return}this.catI=e;this.page=1;this.pageNum=0;this.dataArr=[]}d.mix(o.prototype,{getList:function(H){var e=this.dataArr.length,D=this.catI,F=this.dataArr,C=s[D];var G=Math.ceil(e/C);this.pageNum=G;H=H||1;if(H>G){H=G}if(H<1){H=1}this.page=H;var I="";for(var E=e-(H-1)*C-1;E>Math.max(e-H*C-1,-1);E--){I+=this.getHtmlStr(F[E],E)}return I},showList:function(e){this.panel.getElementsByTagName("UL")[0].innerHTML=this.getList(e);this.changePage()},removeItem:function(e){this.dataArr.splice(e,1);p(x[this.catI],this.dataArr.join(r));if(this.dataArr.length==0){this.showEmpty();return}this.showList(this.page)},changePage:function(){var C=this.page,e=this.pageNum;if(e===0||C===1){w.addClass(this.prevPage,i)}else{w.removeClass(this.prevPage,i)}if(e===0||C===e){w.addClass(this.nextPage,i)}else{w.removeClass(this.nextPage,i)}},bindPage:function(){var C=w.get(".prev",this.panel),e=w.get(".next",this.panel);this.prevPage=C;this.nextPage=e;if(!C){return}var D=this;B.on(C,"click",function(E){E.halt();if(d.UA.ie&&d.UA.ie<8){this.blur()}D.page--;D.showList(D.page)});B.on(e,"click",function(E){E.halt();if(d.UA.ie&&d.UA.ie<8){this.blur()}D.page++;D.showList(D.page)});B.on(w.get(".clearAll",this.panel),"click",function(E){E.halt();if(d.UA.ie&&d.UA.ie<8){this.blur()}D.dataArr.length=0;D.showList(1);p(x[D.catI],"");D.showEmpty()});this.changePage()},showEmpty:function(){this.panel.innerHTML='<div class="record-empty">'+l[this.catI]+"</div>"},showPanel:function(e){if(!d.Cookie.get("_nk_")){Light._openTBLoginPopup();w.removeClass("#tstart-plugin-trace-item","tstart-item-active");return false}var C=m(a(x[this.catI]));this.dataArr=C;var D="";if(!(C+"")){D=q+'<div class="record-empty '+u[this.catI]+'">'+l[this.catI]+"</div>"}else{D=q+'<div class="'+u[this.catI]+'"><ul>'+this.getList(1)+'</ul><a href="#next" class="next" title="\u4e0b\u4e00\u9875">\u4e0b\u4e00\u9875</a><a href="#prev" class="prev '+i+'" title="\u4e0a\u4e00\u9875">\u4e0a\u4e00\u9875</a><div class="'+h+'"><a href="#clearAll" class="clearAll" title="'+n[this.catI]+'">'+n[this.catI]+"</a></div></div>"}e.innerHTML=D;this.bindPanel();this.bindPage()},bindPanel:function(){var e=w.get("."+u[this.catI]);this.panel=e;if(!e){return}var D=this;B.on(e,"click",function(F){var E=F.target;if(E.tagName==="DEL"){F.halt();D.removeItem(parseInt(E.getAttribute("data-index")))}});if(d.UA.ie&&d.UA.ie<7){B.on(e,"mouseover",function(F){var E=F.target;if(E.tagName==="DEL"){w.addClass(E,"hover")}});B.on(e,"mouseout",function(F){var E=F.target;if(E.tagName==="DEL"){w.removeClass(E,"hover")}})}B.on(e.parentNode,"mouseover",function(E){});B.on(e.parentNode,"mouseout",function(E){});B.on(d.get(".tstart-plugin-trace-item-li"),"click",function(E){c.Trace.Item.load(e.parentNode);C();w.addClass(".tstart-plugin-trace-item-li","selected")});B.on(d.get(".tstart-plugin-trace-shop-li"),"click",function(E){c.Trace.Shop.load(e.parentNode);C();w.addClass(".tstart-plugin-trace-shop-li","selected")});B.on(d.get(".tstart-plugin-trace-key-li"),"click",function(E){c.Trace.Search.load(e.parentNode);C();w.addClass(".tstart-plugin-trace-key-li","selected")});function C(){w.removeClass(".tstart-plugin-trace-key-li","selected");w.removeClass(".tstart-plugin-trace-shop-li","selected");w.removeClass(".tstart-plugin-trace-item-li","selected")}}});c.Trace={swfStore:g,TraceStrategy:o,T_SEP:r,T_DATA_SEP:j,KEYS:x,NO_PIC:A,readData:a,saveData:p,formatData:m,flashInstalled:!d.UA.flash||parseInt(d.UA.flash)<9?false:true,loadContent:function(D,C){if(!this.flashInstalled){D.container.innerHTML=q+f;D.removeLoading();return}if(g.isReady){c.Trace[t[C]].load(D.container);D.removeLoading()}else{try{g.on("contentReady",function(){c.Trace[t[C]].load(D.container);D.removeLoading()})}catch(E){d.log("trace: \u6dd8\u8db3\u8ff9 flash \u51fa\u9519.")}}}}});TStart.add("trace-item",function(b){var c=KISSY;function a(l,j){var h=l.split(b.Trace.T_DATA_SEP);if(!h||h.length<3){return""}var f=/\.daily\./.test(location.href)?".daily.taobao.net":".taobao.com";var g=h[1],k=g.indexOf("/"),e=g.slice(1,k);e=e<10?"0"+e:e;var m=c.trim(h[1])?("http://img"+e+f+"/bao/uploaded/"+g+"_60x60.jpg"):b.Trace.NO_PIC;return'<li><a href="http://item'+f+"/item.htm?id="+h[0]+'" target="_blank"><img src="'+m+'" /><span>'+h[2].slice(0,-2)+"."+h[2].slice(-2)+'\u5143</span><del title="\u5220\u9664" data-index="'+j+'">\u5220\u9664</del></a></li>'}var d=function(e){var f=new b.Trace.TraceStrategy(0);f.getHtmlStr=a;f.showPanel(e)};b.Trace.Item={load:d}});TStart.add("trace-shop",function(b){function a(g,f){var e=g.split(b.Trace.T_DATA_SEP);if(e.length!=4){return""}var d=/\.daily\./.test(location.href)?".daily.taobao.net":".taobao.com";if(e[2].indexOf("mall"+d)>-1){var h="http://img03.taobaocdn.com/tps/i3/T1N.tyXcNpXXXXXXXX-70-70.png"}else{var h=e[3].length>1?("http://logo"+d+"/shop-logo"+e[3]):b.Trace.NO_PIC}return'<li><a href="'+e[2]+'" target="_blank" title="'+e[1]+'"><img src="'+h+'" /><span>'+e[1].slice(0,5)+'</span><del title="\u5220\u9664" data-index="'+f+'">\u5220\u9664</del></a></li>'}var c=function(d){var e=new b.Trace.TraceStrategy(1);e.getHtmlStr=a;e.showPanel(d)};b.Trace.Shop={load:c}});TStart.add("trace-search",function(b){function a(e,d){if(!e){return""}return'<li><a href="http://search.taobao.com/search?q='+e.replace(/"/g,"")+'" target="_blank" title="\u641c\u7d22:'+e.replace(/"/g,"")+'">'+e.slice(0,5)+(e.length>5?"...":"")+'<del title="\u5220\u9664" data-index="'+d+'"></del></a></li>'}var c=function(d){var e=new b.Trace.TraceStrategy(2);e.getHtmlStr=a;e.showPanel(d)};b.Trace.Search={load:c}});TStart.add("trace-crawler",function(T){var S=KISSY,DOM=S.DOM,Event=S.Event,Store=S.SWFStore;var Trace=T.Trace,T_SEP=Trace.T_SEP,T_DATA_SEP=Trace.T_DATA_SEP,KEYS=Trace.KEYS;var readData=Trace.readData,saveData=Trace.saveData,formatData=Trace.formatData;var MAX_SIZE=[300,50,50];var swfStore=Trace.swfStore;function init(){crawlItem();crawlShop();crawlSearch()}function saveDataStr(dataStr,catI){var dataArr=formatData(readData(KEYS[catI]));for(var i=dataArr.length-1;i>=0;i--){if(dataArr[i].split(T_DATA_SEP)[0]==dataStr.split(T_DATA_SEP)[0]){dataArr.splice(i,1);break}}dataArr.push(dataStr);while(dataArr.length>MAX_SIZE[catI]){dataArr.shift()}dataStr=dataArr.join(T_SEP);if(dataStr.charAt(0)==T_SEP){dataStr=dataStr.slice(1)}saveData(KEYS[catI],dataStr)}function crawlItem(){if(DOM.get("#J_itemViewed")){var dataObj=eval("("+DOM.attr("#J_itemViewed","data-value")+")"),dataStr="",i,j=0;if(!dataObj){return false}for(i in dataObj){if(i!="xid"&&i!="itemIdStr"){j++;dataStr+=dataObj[i]+T_DATA_SEP}}if(j<3){return false}dataStr=dataStr.slice(0,-1);saveDataStr(dataStr,0)}}function crawlShop(){if(DOM.get("#J_shopViewed")){var dataObj=eval("("+DOM.attr("#J_shopViewed","data-value")+")"),dataStr="",i,j=0;if(!dataObj){return}for(var i in dataObj){if(i=="name"){dataObj[i]=S.trim(dataObj[i]).replace(new RegExp("\\"+T_DATA_SEP,"g"),"").replace(new RegExp(T_SEP,"g"),"")}dataStr+=dataObj[i]+T_DATA_SEP;j++}if(j<4){return false}dataStr=dataStr.slice(0,-1);saveDataStr(dataStr,1)}}function crawlSearch(){var locationUrl=location.href;var title=S.query("#title");if(title.length&&title[0].getAttribute("name")=="q"){var dataStr=S.trim(title[0].value);if(dataStr!="\u8bf7\u8f93\u5165\u8981\u641c\u7d22\u7684\u5185\u5bb9"){dataStr=dataStr.replace(new RegExp(T_SEP,"g"),"");saveDataStr(dataStr,2)}}}T.Trace.Crawler={crawlItem:crawlItem,crawlShop:crawlShop,crawlSearch:crawlSearch,init:init};S.ready(function(){if(!S.Cookie.get("_nk_")){return false}if(!swfStore||!Trace.flashInstalled){return}if(swfStore.isReady){init()}else{try{swfStore.on("contentReady",function(){init()})}catch(e){}}})});TStart.add("plugin~search",function(c){var d=KISSY,e=d.DOM,b=d.Event,a=c.IO,g=document,h=c.PLUGIN_TYPE,f="http://"+(c.Config.isOnline?"a.tbcdn.cn":"assets.daily.taobao.net");c.addPlugin("share",{type:h.LINK,area:"right",text:"\u5206\u4eab\u7ed9\u597d\u53cb",init:function(){var j=this,i=function(){TS.require("Share","2.0",function(){new TS.Share().show()})};b.on("#tstart-plugin-share","click",function(k){k.preventDefault();if("undefined"!==typeof TS){i()}else{j.initScript(i)}new Image().src="http://www.atpanel.com/jsclick?cache="+new Date().getTime()+"&shareapp=share"})},initScript:function(i){a.getScript(f+"/apps/snstaoshare/widget/ts/ts-min.js",i)}});c.addPlugin("settings-sep2",{type:h.SEPARATOR})});TStart.add("plugin~nanny",function(d){var e=KISSY,l=e.DOM,k=e.Event,h=e.UA,b=d.IO,j=document,f=window,g=d.PLUGIN_TYPE,c=/atpanel\.|taobao\.|alimama\.|tmall\.|\:\d+\/auth\/|taobaocdn\.|tbcdn\.|taofula\.|google\.com\.hk|baidu\.|yigoupai\.|sougou\.|youdao\.|linezing\.|127\./i,m=1,a=200,i="http://"+(d.Config.isOnline?"a.tbcdn.cn":"assets.daily.taobao.net");d.addPlugin("nanny",{type:g.CUSTOM,_inited:false,init:function(){var n=this;e.log("nanny: \u51c6\u5907\u542f\u52a8\u8001\u9e28.");k.on(f,"scroll",function(){if(!n._inited){n._inited=true;n.load.call(n)}})},load:function(){var o=this,n=function(){e.log("nanny: \u5f00\u59cb\u8bf7\u6c42\u670d\u52a1\u5668, \u52a0\u8f7d\u8001\u9e28.");TS.require("Nanny",function(){new TS.Nanny(o.log?{log:o.log}:{}).show()})};if(this.check()){if("undefined"!==typeof TS){n()}else{b.getScript(i+"/apps/snstaoshare/widget/ts/ts-min.js?t="+new Date().getTime(),function(){n()})}}},check:function(B){if(location.search.indexOf("shownanny")>-1){e.log("nanny: \u8c03\u8bd5\u72b6\u6001, \u76f4\u63a5\u8bf7\u6c42\u670d\u52a1\u5668.");return true}var D=this,C=e.unparam(location.search.substr(1))["_u"],z=new Date(),w=z.getFullYear(),t=z.getMonth()+1,x=z.getDate(),A=e.unparam(location.search)["refer"]||j.referrer,o,p,r,q=0,v=h.flash&&h.flash>9.1,n=v?(d.store.getItem("nannyExpire")||m):m,y=v?(d.store.getItem("nannyMax")||a):a;D.today=[w,t,x].join("");e.log("nanny: \u4eca\u5929\u662f: "+D.today);e.log("nanny: refer: "+A+"; u: "+C+";");if(!C||(A&&c.test(A))||"+"===C.charAt(C.length-1)){e.log("nanny: refer \u5728\u8fc7\u6ee4\u5217\u8868\u4e2d, \u6216\u8005\u6ca1\u6709 _u \u53c2\u6570");return false}o=parseInt(C.substr(0,1),32).toString();e.log("nanny: today: ",x,"old: ",o,"max: ",n);if((o<x&&(x-o+1)>n)||(o>x&&(x>n||(x+new Date(w,t-1,0).getDate()-o+1)>n))){e.log("nanny: Out of date: old:"+o+"; today: "+x);return false}if(v){e.log("nanny: flash \u7248\u672c\u6b63\u5e38, \u5f00\u59cb\u83b7\u53d6\u672c\u5730\u5b58\u50a8.");try{p=d.store.getItem("nannyCount");if(p){p=p.split("|");r=p[0];if(p[1]!==D.today){D.log=p.join("|")}q=parseInt(r?(p[1]!==D.today?0:r):0,10)}e.log("Today Count: ",q,"Today: ",D.today,"Max Count:",y);D.saveCount(q+1+"|"+D.today);return q<y}catch(s){e.log("nanny: flash \u51fa\u9519, \u653e\u5f03\u8bf7\u6c42.");return false}}else{if(!h.ie){return true}}return true},saveCount:function(n){if(h.flash&&h.flash>9.1){e.log("nanny: \u5b58\u50a8\u8001\u9e28\u8c03\u7528\u6b21\u6570.");d.store.setItem("nannyCount",n)}}})});TStart.add("plugin~news",function(d){var e=KISSY,l=e.DOM,k=e.Event,h=e.UA,g=d.PLUGIN_TYPE,m=e.Cookie.get("_nk_"),i="http://",b=d.Config.isOnline,a=i+(b?"i.taobao.com":"i.daily.taobao.net"),f="tracelog=toolmessage",c=a+"/message/view_message.htm?"+f,j=i+(b?"shuo.taobao.com":"shuo.daily.taobao.net");d.addPlugin(["news"],{type:g.CUSTOM,area:"right",html:'<span class="tstart-normal-trigger tstart-news-hd"><s class="tstart-item-icon"></s><a href="'+c+'" target="_blank">\u6d88\u606f</a><b class="news-num J_NewsNum" style="display:none"><s></s></b></span>',init:function(){if(!m||((!h.flash||h.flash<=9.1)&&h.ie)){e.log("news: \u672a\u767b\u5f55\u6216\u8005\u662f ie \u6d4f\u89c8\u5668\u5e76\u4e14\u4e0d\u652f\u6301 flash; exit!");return false}e.log("news: \u652f\u6301 flash \u6216\u8005\u662f\u9ad8\u7ea7\u6d4f\u89c8\u5668, \u6d88\u606f\u5f00\u59cb\u8f7d\u5165.");d.news.init({nick:unescape(m.replace(/\\u/g,"%u")),itaobao:a,message:c,tracelog:f,weidian:j})}});d.addPlugin("settings-sep1",{type:g.SEPARATOR})});TStart.add("news~main",function(f){var g=KISSY,m=g.DOM,l=g.Event,i=g.UA,e=f.IO,j="http://",d=f.Config.isOnline,c=/(i|jianghu)\.([^\.]+\.)*taobao/i,h=[1,6],b,k="news",a="TMSG_HAS_NEW";f.news={config:{},init:function(n){b="TMSG_"+n.nick;var p=this,o=p.Render,q=p.Daemon;p._setup(n);if(!i.flash||i.flash<=9.1){g.log("\u6ca1\u6709 falsh \u7684\u9ad8\u7ea7\u6d4f\u89c8\u5668.");q.getData();p._bindEvent()}else{g.log("\u652f\u6301 flash.");try{f.store.on("contentReady",function(){if(p.config.isItaobao){g.log("itaobao \u9875\u9762.");q.start();q.getData();q.poll()}else{g.log("news: \u975e itaobao \u9875\u9762.");p.getCount()}p._bindEvent()})}catch(r){}}f.renderNews=function(s){p.renderNews.call(p,s)};f.clearNews=function(s){p.clearNews.call(p,s)};return p},_setup:function(n){g.mix(this.config,g.merge(n,{isItaobao:c.test(location.host)}))},getCount:function(o,p){g.log("news: \u5f00\u59cb\u83b7\u53d6\u6d88\u606f\u6570.");var n=this;o=o||n.Store.read(b,k);g.log("news: \u83b7\u53d6\u6d88\u606f\u7ed3\u675f.");if(o){g.log("news: \u6709\u6570\u636e: "+o);n.Render.showCount(o["-1"]||0)}else{if(!p){g.log("news: \u65e0\u6570\u636e, \u8bf7\u6c42\u670d\u52a1\u5668.");n.Daemon.getData()}}},_bindEvent:function(){var p=this,o=p.Render,q=p.Daemon,n=m.get("#tstart-plugin-news");l.on(n,"mouseenter",function(s){g.log("news: mouseenter.");var r=m.children(n);if(1===r.length){g.log("news: \u6ca1\u6709\u6d88\u606f\u8282\u70b9.");o.createPopup(n);o.renderMessage(b,k)}else{if(p.config.isItaobao&&i.flash>9.1){g.log("news: \u6709\u6d88\u606f\u8282\u70b9, \u5e76\u4e14 flash \u7248\u672c\u5927\u4e8e 9.1, \u5e76\u4e14\u662f itaobao \u9875\u9762.");o.renderMessage(b,k)}}p.show()});l.on(n,"mouseleave",p.hide);l.on(n,"click",function(r){g.log("news: \u70b9\u51fb\u6d88\u606f.");var t=r.target,s,u;if(m.hasClass(t,"J_News")){u=m.attr(t,"data-id");g.log("news: \u88ab\u70b9\u51fb\u7684\u6d88\u606f\u7c7b\u578b: "+u);if(g.indexOf(u*1,h)>-1){g.log("news: \u8be5\u6d88\u606f\u7c7b\u578b\u4e3a\u793e\u533a\u6216\u8005\u4ea4\u6613, \u9700\u8981\u8bf7\u6c42\u670d\u52a1\u5668.");return q.getData()}p.clearNews(u);p.hide();m.parent(t).parentNode.removeChild(m.parent(t));p.getCount(s)}});if(i.flash&&i.flash>9.1&&p.config.isItaobao){l.on(window,"focus",function(s){g.log("news: focus.");p.config.isFocus=true;var r=g.Cookie.get("_nk_");if(!r||(r&&p.config.nick!==unescape(r.replace(/\\u/g,"%u")))){g.log("news: nick \u4e0d\u5b58\u5728\u6216\u8005 session \u5931\u6548, \u9000\u51fa\u8f6e\u8be2.");q.exit();return false}if("1"==f.store.getItem(r+a)){g.log("news: \u6709\u65b0\u6d88\u606f, \u8bf7\u6c42\u670d\u52a1\u5668.");q.getData()}else{g.log("news: \u6709\u6d88\u606f\u88ab\u6e05\u9664, \u9700\u8981\u91cd\u65b0\u6e32\u67d3\u6d88\u606f\u6570.");p.getCount(null,true)}q.poll()});l.on(window,"blur",function(r){g.log("news: blur.");p.config.isFocus=false;q.stop()});window._retry=function(r){g.log("news: \u957f\u8fde\u63a5\u51fa\u9519, \u5f00\u59cb\u91cd\u65b0\u5efa\u7acb\u8fde\u63a5, \u9519\u8bef\u4ee3\u7801\u4e3a: "+r);try{q.stop();q.start()}catch(s){g.log("news: \u91cd\u65b0\u5efa\u7acb\u957f\u8fde\u63a5\u5931\u8d25, \u9519\u8bef\u4fe1\u606f\u4e3a: "+s)}}}},show:function(){g.log("news: \u663e\u793a\u6d88\u606f start.");var n=m.get("ul","#tstart-plugin-news");if(n&&m.children(n).length>0){g.log("news: \u663e\u793a\u6d88\u606f, \u6709\u6570\u636e.");m.addClass("#tstart-plugin-news","tstart-item-active")}},hide:function(){g.log("news: \u9690\u85cf\u6d88\u606f.");m.removeClass("#tstart-plugin-news","tstart-item-active")},renderNews:function(o){g.log("news: \u6e32\u67d3\u6d88\u606f.");var n=this;n.Store.write(b,k,o,true);n.config.newsData=o;if(!o){g.log("news: \u65e0\u672c\u5730\u6570\u636e.");o={"-1":0}}n.Render.showCount(o["-1"]||0);f.store.setItem(g.Cookie.get("_nk_")+a,"0")},clearNews:function(o){g.log("news: \u6e05\u9664\u6d88\u606f.");var p=this,q=p.Store.read(b,k),n;if(q&&i.flash>9.1){if(o){if(q[o]){q["-1"]-=q[o];delete q[o];p.Store.write(b,k,q,true)}}else{p.Daemon.getData()}}}};return f.news});TStart.add("news~store",function(T){var S=KISSY,DOM=S.DOM,Event=S.Event,UA=S.UA,EXPIRE_TIME=6*60*60*1000,EMPTY="";T.news.Store={read:function(identify,key){S.log("news: \u5f00\u59cb\u8bfb\u53d6\u6d88\u606f\u5b58\u50a8.");var ret=EMPTY,data,now=new Date().getTime();if(UA.flash>9.1){S.log("news: flash \u7248\u672c\u5927\u4e8e 9.1.");data=T.store.getItem(identify);if(data){S.log("news: \u6709\u6570\u636e:"+data);data=eval("("+T.store.getItem(identify)+")");if(data[key]&&((now-data.date)<=EXPIRE_TIME||T.news.config.isItaobao)){S.log("news: \u6570\u636e\u6ca1\u6709\u8fc7\u671f, \u6216\u8005\u662f\u5728 itaobao \u9875\u9762.");ret=data[key]}}}return ret},write:function(identify,key,data,overwrite){S.log("news: \u5f00\u59cb\u5199\u5165\u5b58\u50a8");var host=this,d={},i;d[key]={};if(data){S.log("news: \u6709\u6570\u636e.");if(!overwrite){S.log("news: \u6539\u5199.");d=host.read(identify,key);if(d){for(i in data){d[key][i]=data[i]}}}else{S.log("news: \u8986\u76d6.");d[key]=data}}T.store.setItem(identify,S.merge(d,{date:new Date().getTime()}))}};return T.news.Store});TStart.add("news~render",function(c){var d=KISSY,k=d.DOM,j=d.Event,f=d.UA,i=document,b=c.news.config,a="",h='<div class="tstart-normal-panel tstart-news-bd"><div class="tstart-normal-panel-bd"><ul></ul></div></div>',e='<li><a href="{href}" target="_blank" data-id="{id}" class="J_News">{count} {name}</a></li>',g={1:"\u6761\u4ea4\u6613\u63d0\u9192",2:"\u6761\u901a\u77e5",3:"\u4f4d\u65b0\u7c89\u4e1d",4:"\u6761\u65b0\u7559\u8a00",5:"\u6761\u597d\u53cb\u7533\u8bf7",6:"\u6761\u793e\u533a\u6d88\u606f"};c.news.Render={showCount:function(n){d.log("news: \u663e\u793a\u6d88\u606f\u6570: "+n);var l=n||0,m=k.get(".J_NewsNum","#tstart-plugin-news");m.innerHTML="<s>"+l+"</s>";if(0===l){k.css(m,"display","none")}else{k.css(m,"display",a)}},renderMessage:function(r,o){var p=this,l=p.messageContainer,s=i.createDocumentFragment(),q=f.flash>9.1?c.news.Store.read(r,o):b.newsData,n,m={1:b.message+"&msgType=1",2:b.message+"&msgType=2",3:b.weidian+"/microshop/manage/manage_fans.htm?"+b.tracelog,4:b.weidian+"/microshop/front.htm?active=1&clear=true&"+b.tracelog,5:b.message+"&msgType=5",6:b.message+"&msgType=6"};for(n in q){if(n>-1&&q[n]>0){s.appendChild(k.create(p.substitute(e,{name:g[n],count:q[n],id:n,href:m[n]})))}}l.innerHTML=a;l.appendChild(s)},createPopup:function(m){var l=this,n=k.create(h);m.appendChild(n);l.newsBd=n;l.messageContainer=k.get("ul",n);l.renderMessage()},substitute:function(n,m,l){if(!d.isString(n)||!d.isPlainObject(m)){return n}return n.replace(l||/\\?\{([^{}]+)\}/g,function(p,o){if(p.charAt(0)==="\\"){return p.slice(1)}return(m[o]!=="undefined")?m[o]:a})}};return c.news.Render});TStart.add("news~deamon",function(e){var f=KISSY,l=f.DOM,j=f.Event,g=f.UA,c=e.IO,d=e.news.config,a="TMSG_HAS_NEW",i="http://",b=e.Config.isOnline,h=i+(b?"a.tbcdn.cn":"assets.daily.taobao.net"),k=i+(b?"remind.taobao.com":"remind.daily.taobao.net")+"/remind.do";e.news.Daemon={start:function(){f.log("news: \u5f00\u59cb\u957f\u8fde\u63a5");var o=this,n=o.connection,m=function(){if(!n||"closed"===n.status){o.connection=n=new sns.push.client({server:k,nick:encodeURIComponent(d.nick)});n.regist(function(p,q){if(q){e.store.setItem(f.Cookie.get("_nk_")+a,"1");if(d.isFocus){o.getData()}}})}n.start()};if("undefined"!==typeof sns){m()}else{c.getScript(h+"/p/tstart/1.0/plugins/news/pushclient.js",m)}},stop:function(){var m=this["timer"];if(m){clearTimeout(m)}},getData:function(){f.log("news: \u8bf7\u6c42\u670d\u52a1\u5668\u83b7\u53d6\u6d88\u606f\u6570\u636e");c.jsonp(("undefined"!==typeof TSURI?TSURI.news:(d.itaobao+"/json/unread_number.htm?msgType="))+"1,2,3,4,5,6&t="+new Date().getTime(),"TStart.renderNews")},exit:function(){var m=this;f.log("news: \u9000\u51fa\u957f\u8fde\u63a5.");try{m.connection.stop()}catch(n){f.log("news: \u505c\u6b62\u957f\u8fde\u63a5\u51fa\u9519.")}},poll:function(){f.log("news: \u5f00\u59cb\u6d88\u606f\u8f6e\u8be2");var n=this,o=n.timer,m=f.Cookie.get("_nk_");if(o){clearTimeout(o)}if(!m||(m&&d.nick!==unescape(m.replace(/\\u/g,"%u")))){f.log("news: nick \u4e0d\u5b58\u5728\u6216\u8005 session \u5931\u6548, \u9000\u51fa\u8f6e\u8be2.");n.exit();return false}n.timer=setTimeout(function(){if(d.isFocus){n.start();e.news.getCount();n.timer=setTimeout(arguments.callee,6000)}},6000)}};return e.news.Daemon});KISSY.app("TDog",function(){var g=KISSY,l=g.DOM,f=TStart,i=window,k=i.g_config&&i.g_config["appId"],a=f.Config.isOnline,b=f.Config.DOMAIN,j=(function(){var m=location.hostname;if(m.indexOf("tmall.com")>0){m="webww.tmall.com"}else{if(m.indexOf("tmall.net")>0){m="webww.daily.tmall.net:8080"}else{if(m.indexOf("taobao.net")>0){m="webww.daily.taobao.net:8080"}else{m="webwangwang.taobao.com"}}}return"http://"+m+"/"})(),e=(function(){var m=location.hostname;if(m.indexOf("tmall.com")>0){m="webww.tmall.com"}else{if(m.indexOf("tmall.net")>0){m="webww.daily.tmall.net:8080"}else{if(m.indexOf("taobao.net")>0){m="webww.daily.taobao.net:8080"}else{m="get.webwangwang.taobao.com"}}}return"http://"+m+"/"})(),d=".do",h="http://www.taobao.com/wangwang/2010_fp/buyer.php?tracelogww2010=webww",c="http://www.taobao.com/wangwang/2010_fp/seller.php?tracelogww2010=webww";return{version:"1.0",Config:{loginUrl:j+"login"+d,getLoginResultUrl:j+"getloginresult"+d,startUrl:j+"start"+d,receiveUrl:j+"receive"+d,sendUrl:j+"send"+d,getUrl:j+"get"+d,notifyUrl:e+"connection.html?t=20110322",connectionURL:j+"buildconnection"+d,checkAutoLoginUrl:j+"usertag.do",getTalkUsers:j+"gettalkusers"+d,ackGetMessage:j+"ackgetmessage"+d,tbLoginUrl:"https://login."+b+"/member/login.jhtml?f=top",tmsAdUrl:"http://www.taobao.com/go/rgn/tdog/link-for-chat-window.php",tmsBulletinUrl:"http://www.taobao.com/go/rgn/wangwang/webww-tips20101012.php",clearUrl:j+"clear.do",clearListUrl:j+"clear.do?act=2",setAutoLoginUrl:j+"usertag.do",TagKeyUrl:j+"tagkey.do",LIGHT_NICK:"wwlight",forceAutoLogin:false,appId:k,X:"x",NOTIFY_STATUS:{logout:{key:0,value:-1},timeout:{key:1,value:-2},message:{key:2,value:-3},close:{key:3,value:-4},notMessage:{key:4,value:0}},downloadWangWangURLBuy:h,downloadWangWangURLSeller:c,DOMAIN:b,LOGIN_KEY:"login_key",hash:[9,6,7,19,15,22,2,26,18,24,21,25,16,13,25,12]},isReady:false,init:function(v,A){g.log("\u5f00\u59cb\u521d\u59cb\u5316 Web \u65fa\u65fa");var w=this,t=w.Util,p=w.Config,q=w.Login,z=w.SysTips,s=w.DataManager,m=g.Cookie.get(p.X),r=g.get("#tstart");q.init();w.host=v;w.hostEl=A;z.init();w.StatusIcon.init();w.EventCenter.init();if(g.unparam(m).p==="tdog"||Light.addonIsOK()||!s.getNickName()){g.log("\u63a7\u4ef6\u5b89\u88c5\u6b63\u5e38\u6216\u6dd8\u5b9d\u672a\u767b\u5f55\uff0cWeb \u65fa\u65fa\u9000\u51fa\u521d\u59cb\u5316");l.addClass(r,"tstart-tdog-disabled");return}else{if(Light.addonIsOK()){g.log("\u63a7\u4ef6\u5b89\u88c5\u6b63\u5e38\uff0c\u5de5\u5177\u6761\u4e0a\u4e0d\u663e\u793a Web \u65fa\u65fa\uff0c\u9000\u51fa\u521d\u59cb\u5316");l.addClass(r,"tstart-tdog-disabled");return}else{if(Light.addonIsOK()){g.log("\u63a7\u4ef6\u5b89\u88c5\u6b63\u5e38\uff0c\u5de5\u5177\u6761\u4e0a\u4e0d\u663e\u793a Web \u65fa\u65fa\uff0c\u9000\u51fa\u521d\u59cb\u5316");l.addClass(r,"tstart-tdog-disabled");return}}}l.addClass(r,"tstart-tdog-enable");var y=location.search;if(y&&(y=y.substring(1))){var n=g.unparam(y),x=n[p.LIGHT_NICK];if(k===0){x=t.decode(n.touid||n.tid)}if(x){g.log("wwlight = "+x);if(!t.hasSitePrefix(x)){x="cntaobao"+x}Light.lightedUsers.push(x);p.forceAutoLogin=true}}if(k===7&&r){r.style.zIndex=20001}u();function u(){s.init();w.WebServer.init();w.RecentList.init();w.ChatDialog.init();w.SysMessage.init();w.SysPopup.init();w.isReady=true;w.EventCenter.fire(w.EVENTS.TDOG_READY)}},EVENTS:{CLICK_LIGHT_ICON:"clickLightIcon",CLICK_STATUS_ICON:"clickStatusIcon",LOGIN_START:"loginStart",LOGIN_SUCCESS:"loginSuccess",ERROR_LOGIN_FAILED:"errorLoginFailed",SHOW_RECENT_LIST:"showRecentList",SHOW_CHAT_DIALOG:"showChatDialog",SHOW_CHAT_MSG:"showChatMsg",RECEIVE_CHAT_MESSAGE:"receiveChatMessage",RECEIVE_SUBSCRIBE_MESSAGE:"receiveSystemMessage",RECEIVE_POPUP_MESSAGE:"receivePopupMessage",RECEIVE_LOGINOUT_SIGNAL:"receiveLoginoutSignal",UPDATE_USER_STATUS:"updateUserStatus",UPDATE_STATUS_ICON:"updateStatusIcon",ERROR_GET_CHAT_INFO:"errorGetChatInfo",UPDATE_CHAT_INFO:"updateChatInfo",SEND_MESSAGE:"sendMessage",ERROR_GET_MESSAGE:"errorGetMessage",UPDATE_LOCAL_STATUS:"updateLocalStatus",DAEMON_FIRE:"daemonFire",TDOG_READY:"tdogReady"},USER_STATUS:{1:["offline","\u79bb\u7ebf"],2:["free","\u5728\u7ebf"],3:["busy","\u5fd9\u788c\u4e2d"],4:["away","\u4e0d\u5728\u7535\u8111\u65c1"],5:["incall","\u63a5\u542c\u7535\u8bdd\u4e2d"],6:["outofdinner","\u5916\u51fa\u5c31\u9910"],7:["wait","\u7a0d\u5019"],8:["invisible",""],9:["offlinelogin",""],10:["unknown",""],11:["fakeonline",""],12:["mobileonline","\u624b\u673a\u5728\u7ebf"]},ERROR_MESSAGE:{"0":"","1":"\u8d26\u6237\u4e0d\u5b58\u5728\uff0c\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u8d26\u6237\u540d\u3002","2":"\u60a8\u8f93\u5165\u7684\u8d26\u6237\u540d\u548c\u5bc6\u7801\u4e0d\u5339\u914d\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165\u3002","3":'\u60a8\u7684\u5e10\u53f7\u4e0d\u80fd\u767b\u5f55\u7f51\u9875\u7248\u65fa\u65fa\uff0c\u8bf7\u4f7f\u7528\u963f\u91cc\u65fa\u65fa\u5ba2\u6237\u7aef\uff0c<a target="_blank" class="tstart-item-tips-on" href="'+c+'">\u70b9\u6b64\u4e0b\u8f7d\uff01</a>',"4":"\u60a8\u7684\u8d26\u6237\u6743\u9650\u4e0d\u591f\u3002","5":"\u60a8\u767b\u5f55\u7684\u5e10\u53f7\u6570\u91cf\u5df2\u8d85\u8fc7\u6700\u5927\u6570\u91cf\u3002","6":'\u60a8\u662fE\u5ba2\u670d\u7528\u6237\uff0c\u53ea\u80fd\u4f7f\u7528\u963f\u91cc\u65fa\u65fa\uff0c<a target="_blank" class="tstart-item-tips-on" href="'+c+'">\u70b9\u6b64\u4e0b\u8f7d\uff01</a>',"-1":"\u7cfb\u7edf\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u518d\u8bd5\u3002","-2":"\u5bf9\u65b9\u8d26\u53f7\u4e0d\u5b58\u5728\uff0c\u8bf7\u68c0\u67e5\u3002","-3":"\u8d26\u6237\u4e0d\u5b58\u5728\uff0c\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u8d26\u6237\u540d\u3002","-4":"\u767b\u5f55\u5931\u8d25\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55\u3002","-5":"\u767b\u5f55\u5931\u8d25\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55\u3002","-6":"\u53d1\u9001\u6d88\u606f\u4e0d\u5141\u8bb8\u4e3a\u7a7a\u3002","-7":"\u60a8\u53d1\u9001\u7684\u6d88\u606f\u8fc7\u957f\uff0c\u8bf7\u4e0b\u8f7d\u652f\u6301\u53d1\u9001\u8d85\u957f\u4fe1\u606f\u7684\u963f\u91cc\u65fa\u65fa\u5ba2\u6237\u7aef\u3002","-8":"\u963f\u91cc\u65fa\u65fa\u6682\u65f6\u4e0d\u53ef\u7528\uff0c\u8bf7\u7a0d\u5019\u518d\u8bd5\u3002","-9":"\u8d26\u6237\u4e0d\u5b58\u5728\uff0c\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u8d26\u6237\u540d\u3002","-10":"\u963f\u91cc\u65fa\u65fa\u6682\u65f6\u4e0d\u53ef\u7528\uff0c\u8bf7\u7a0d\u5019\u518d\u8bd5\u3002","-11":"\u7cfb\u7edf\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002","-12":"\u963f\u91cc\u65fa\u65fa\u6682\u65f6\u4e0d\u53ef\u7528\uff0c\u8bf7\u7a0d\u5019\u518d\u8bd5\u3002","-14":"\u8bfb\u6d88\u606f\u51fa\u9519\uff0c\u8bf7\u91cd\u8bd5\u3002","-15":"\u963f\u91cc\u65fa\u65fa\u5ba2\u6237\u7aef\u5728\u7ebf\uff0c\u662f\u5426\u8e22\u6389\u963f\u91cc\u65fa\u65fa\u5ba2\u6237\u7aef\u3002","-16":"\u963f\u91cc\u65fa\u65fa\u5ba2\u6237\u7aef\u5728\u7ebf\uff0c\u662f\u5426\u8e22\u6389\u963f\u91cc\u65fa\u65fa\u5ba2\u6237\u7aef\u3002","-17":"\u767b\u5f55\u5931\u8d25\uff0c\u975e\u6cd5\u8bf7\u6c42\u3002","-100":"\u963f\u91cc\u65fa\u65fa\u5df2\u79bb\u7ebf\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55\u3002","-101":"\u60a8\u8fd8\u6ca1\u6709\u767b\u5f55\uff0c\u8bf7\u767b\u5f55\u3002","-102":'\u60a8\u7684\u5e10\u53f7\u88ab\u7981\u6b62\u767b\u5f55WEB\u65fa\u65fa\uff0c\u8bf7\u4f7f\u7528\u963f\u91cc\u65fa\u65fa\u5ba2\u6237\u7aef\u767b\u5f55\uff08<a target="_blank" class="tstart-item-tips-on" href="'+h+'">\u70b9\u6b64\u4e0b\u8f7d\uff01</a>\uff09\u3002',"-1000":"\u83b7\u53d6\u4fe1\u606f\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002","-1001":"\u83b7\u53d6\u4fe1\u606f\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002","-40000":'\u8981\u652f\u6301\u8be5\u529f\u80fd\uff0c\u8bf7\u4e0b\u8f7d <a  target="_blank" href="'+h+'">\u963f\u91cc\u65fa\u65fa\u5ba2\u6237\u7aef</a>'},MESSAGE_TYPE:{OFFLINE:1,TALK:2,STATUS:3,LOGOUT:4,SYSTEM:5,SELF:6},MESSAGE_SUBTYPE:{TALK_MESSAGE:201,AUTO_BACK_TALK_MESSAGE:202,NEED_AUTH:204,FAIL_ACK:205,FILE_MESSAGE:206,PIC_MESSAGE:207,GRAFFITI:208,REMOTE_ASSIST:209,AV:210,FOLDER:211,ILLEGALITY:212,PEER_VERIFY:213,NO_HEARTBEAT:401,OTHER_LOGIN:402,SESSION_TIMEOUT:403,POPUP_MESSAGE:501,SUBSCRIBE_MESSAGE:502},UNSUPPORT_MSG:{204:"\u5bf9\u65b9\u9700\u8981\u9a8c\u8bc1\uff0c\u6682\u65f6\u65e0\u6cd5\u53d1\u9001\u3002",205:"\u53d1\u9001\u3010{content}\u3011\u6d88\u606f\u5931\u8d25\u3002",206:"\u5bf9\u65b9\u6b63\u5411\u60a8\u4f20\u6587\u4ef6\u3002",207:"\u5bf9\u65b9\u6b63\u5411\u60a8\u53d1\u56fe\u7247\u3002",208:"\u5bf9\u65b9\u6b63\u9080\u8bf7\u60a8\u6d82\u9e26\u3002",209:"\u5bf9\u65b9\u6b63\u9080\u8bf7\u60a8\u8fdc\u7a0b\u534f\u52a9\u3002",210:"\u5bf9\u65b9\u6b63\u9080\u8bf7\u60a8\u8bed\u97f3\u89c6\u9891\u3002",211:"\u5bf9\u65b9\u6b63\u5411\u60a8\u4f20\u6587\u4ef6\u5939\u3002",212:"\u60a8\u53d1\u9001\u7684\u6d88\u606f\u4e2d\u53ef\u80fd\u5305\u542b\u4e86\u6076\u610f\u7f51\u5740\u3001\u8fdd\u89c4\u5e7f\u544a\u53ca\u5176\u4ed6\u7c7b\u5173\u952e\u8bcd\uff0c\u8bf7\u505c\u6b62\u53d1\u9001\u7c7b\u4f3c\u7684\u6d88\u606f\uff01",213:"\u5bf9\u65b9\u9700\u8981\u9a8c\u8bc1\uff0c\u6682\u65f6\u65e0\u6cd5\u53d1\u9001\u3002"},SITES:{TAOBAO:"cntaobao",YAHOO:"chnyahoo",WANGWANG:"wangwnag",CNALICHN:"cnalichn",ENALIINT:"enaliint",CNALIMAM:"cnalimam",CNKOUBEI:"cnkoubei",HTYAHOO:"htyahooo",CNWUJING:"cnwujing",CHNAIGOU:"chnaigou"}}});TDog.add("Util",function(a){var c=KISSY,b=a.Config.DOMAIN;a.Util={contains:function(d,e){for(var f=d.length-1;f>=0;f--){if(d[f].sendTime==e.sendTime&&d[f].content==e.content){return true}}return false},uniqueArray:function(h){var g=[],e=h.length;var d=function(j,l){for(var k=0,m=j.length;k<m;k++){if(j[k]==l){return true}}return false};for(var f=0;f<e;f++){if(!d(g,h[f])){g.push(h[f])}}return g},css:function(d,f){var e=KISSY.DOM;KISSY.each(d,function(g){e.css(g[0],g[1],g[2])})},getRandom:function(e,d){return e+parseInt((d-e+1)*Math.random(),10)},genUniqueName:function(){for(var d=0,e="";d<10;d++){e+=String.fromCharCode(this.getRandom(97,122))}return"_"+e+(+new Date)},decode:function(f){if(!f){return""}var d=f;try{d=decodeURIComponent(f)}catch(e){}return d},SITES_REG:(function(){var e=[];for(var d in a.SITES){e.push(a.SITES[d])}return new RegExp("^("+e.join("|")+")(.*)$","i")})(),hasSitePrefix:function(d){return a.Util.SITES_REG.test(d)},getUserName:function(f){if(!f){return""}var e=f,d=f.match(a.Util.SITES_REG);if(d&&d[1]){e=f.substr(d[1].length)}return e},substitute:function(d,e){return d.replace(/\{([^}]+)\}/g,function(f,g){return e[g]||""})},escapeHTML:function(e){var f=document.createElement("div"),d=document.createTextNode(e);f.appendChild(d);return f.innerHTML},isTaobao:function(){return b==="taobao.com"||b==="taobao.net"},formatDate:function(d){var e="";e+=d.getFullYear()+"-";if(d.getMonth()+1<10){e+="0"+(d.getMonth()+1)+"-"}else{e+=(d.getMonth()+1)+"-"}if(d.getDate()<10){e+="0"+(d.getDate())+" "}else{e+=(d.getDate())+" "}if(d.getHours()<10){e+="0"+d.getHours()}else{e+=d.getHours()}if(d.getMinutes()<10){e+=":0"+d.getMinutes()}else{e+=":"+d.getMinutes()}if(d.getSeconds()<10){e+=":0"+d.getSeconds()}else{e+=":"+d.getSeconds()}return e},getTmsContent:function(f){return;if(!f){return}var d=this,e=KISSY;e.each(f,function(g){var h=g;if(h.data){e.isFunction(h.hasDate)&&h.hasDate()}else{e.later(function(){a.Util.getScript(h.link+"?callback="+h.callback+"&t="+ +new Date,{onSuccess:function(){e.isFunction(d.hasDate)&&h.success()},scope:d,charset:a.Config.charset||"gbk"})},0)}})},charToFace:(function(){var d={"/:^_^":["\u5fae\u7b11","0"],"/:^$^":["\u5bb3\u7f9e","1"],"/:Q":["\u5410\u820c\u5934","2"],"/:815":["\u5077\u7b11","3"],"/:809":["\u7231\u6155","4"],"/:^O^":["\u5927\u7b11","5"],"/:081":["\u8df3\u821e","6"],"/:087":["\u98de\u543b","7"],"/:086":["\u5b89\u6170","8"],"/:H":["\u62b1\u62b1","9"],"/:012":["\u52a0\u6cb9","10"],"/:806":["\u80dc\u5229","11"],"/:b":["\u5f3a","12"],"/:^x^":["\u4eb2\u4eb2","13"],"/:814":["\u82b1\u75f4","14"],"/:^W^":["\u9732\u9f7f\u7b11","15"],"/:080":["\u67e5\u627e","16"],"/:066":["\u547c\u53eb","17"],"/:807":["\u7b97\u8d26","18"],"/:805":["\u8d22\u8ff7","19"],"/:071":["\u597d\u4e3b\u610f","20"],"/:072":["\u9b3c\u8138","21"],"/:065":["\u5929\u4f7f","22"],"/:804":["\u518d\u89c1","23"],"/:813":["\u6d41\u53e3\u6c34","24"],"/:818":["\u4eab\u53d7","25"],"/:015":["\u8272\u60c5\u72c2","26"],"/:084":["\u5446\u82e5\u6728\u9e21","27"],"/:801":["\u601d\u8003","28"],"/:811":["\u8ff7\u60d1","29"],"/:?":["\u7591\u95ee","30"],"/:077":["\u6ca1\u94b1\u4e86","31"],"/:083":["\u65e0\u804a","32"],"/:817":["\u6000\u7591","33"],"/:!":["\u5618","34"],"/:068":["\u5c0f\u6837","35"],"/:079":["\u6447\u5934","36"],"/:028":["\u611f\u5192","37"],"/:026":["\u5c34\u5c2c","38"],"/:007":["\u50bb\u7b11","39"],"/:816":["\u4e0d\u4f1a\u5427","40"],"/:&apos;&quot;&quot;":["\u65e0\u5948","41"],"/:&#39;&quot;&quot;":["\u65e0\u5948","41"],'/:\'""':["\u65e0\u5948","41"],"/:802":["\u6d41\u6c57","42"],"/:027":["\u51c4\u51c9","43"],"/:(Zz...)":["\u56f0\u4e86","44"],"/:*&amp;*":["\u6655","45"],"/:*&*":["\u6655","45"],"/:810":["\u5fe7\u4f24","46"],"/:&gt;_&lt;":["\u59d4\u5c48","47"],"/:>_<":["\u59d4\u5c48","47"],"/:018":["\u60b2\u6ce3","48"],"/:&gt;O&lt;":["\u5927\u54ed","49"],"/:>O<":["\u5927\u54ed","49"],"/:020":["\u75db\u54ed","50"],"/:044":["I\u670d\u4e86U","51"],"/:819":["\u5bf9\u4e0d\u8d77","52"],"/:085":["\u518d\u89c1","53"],"/:812":["\u76b1\u7709","54"],"/:&quot;":["\u597d\u7d2f","55"],'/:"':["\u597d\u7d2f","55"],"/:&gt;M&lt;":["\u751f\u75c5","56"],"/:>M<":["\u751f\u75c5","56"],"/:&gt;@&lt;":["\u5410","57"],"/:>@<":["\u5410","57"],"/:076":["\u80cc","58"],"/:069":["\u60ca\u8bb6","59"],"/:O=O":["\u8001\u5927","70"],"/:O":["\u60ca\u6115","60"],"/:067":["\u95ed\u5634","61"],"/:043":["\u6b20\u6241","62"],"/:P":["\u9119\u89c6\u4f60","63"],"/:808":["\u5927\u6012","64"],"/:&gt;W&lt;":["\u751f\u6c14","65"],"/:>W<":["\u751f\u6c14","65"],"/:073":["\u8d22\u795e","66"],"/:008":["\u5b66\u4e60\u96f7\u950b","67"],"/:803":["\u606d\u559c\u53d1\u8d22","68"],"/:074":["\u5c0f\u4e8c","69"],"/:036":["\u90aa\u6076","71"],"/:039":["\u5355\u6311","72"],"/:045":["CS","73"],"/:046":["\u9690\u5f62\u4eba","74"],"/:048":["\u70b8\u5f39","75"],"/:047":["\u60ca\u58f0\u5c16\u53eb","76"],"/:girl":["\u6f02\u4eaeMM","77"],"/:man":["\u5e05\u54e5","78"],"/:052":["\u62db\u8d22\u732b","79"],"/:(OK)":["\u6210\u4ea4","80"],"/:8*8":["\u9f13\u638c","81"],"/:)-(":["\u63e1\u624b","82"],"/:lip":["\u7ea2\u5507","83"],"/:-F":["\u73ab\u7470","84"],"/:-W":["\u6b8b\u82b1","85"],"/:Y":["\u7231\u5fc3","86"],"/:qp":["\u5fc3\u788e","87"],"/:$":["\u94b1","88"],"/:%":["\u8d2d\u7269","89"],"/:(&amp;)":["\u793c\u7269","90"],"/:(&)":["\u793c\u7269","90"],"/:@":["\u6536\u90ae\u4ef6","91"],"/:~B":["\u7535\u8bdd","92"],"/:U*U":["\u4e3e\u676f\u5e86\u795d","93"],"/:clock":["\u65f6\u949f","94"],"/:R":["\u7b49\u5f85","95"],"/:C":["\u5f88\u665a\u4e86","96"],"/:plane":["\u98de\u673a","97"],"/:075":["\u652f\u4ed8\u5b9d","98"]},f="";for(var g in d){f+="|"+g.substring(2)}f=f.substring(1);f=f.replace(/([\^?()\.\*\$])/g,"\\$1");var e=new RegExp("\\\\T/:("+f+")\\\\T","g");f=new RegExp("/:("+f+")","g");return function(i,k,h){if(i){if(k){var j=new RegExp("\\\\","g");i=i.replace(j,function(l){l="\\\\";return l});i=i.replace(f,function(l){if(d[l]){l="\\T"+l+"\\T"}return l})}else{if(h){i=i.replace(e,function(l){var m=l.substring(2,l.length-2);if(d[m]){l='<img src="http://a.tbcdn.cn/sys/wangwang/smiley/48x48/'+d[m][1]+'.gif" alt="'+d[m][0]+'" />'}return l})}else{i=i.replace(f,function(l){if(d[l]){l='<img src="http://a.tbcdn.cn/sys/wangwang/smiley/48x48/'+d[l][1]+'.gif" alt="'+d[l][0]+'" />'}return l})}}}return i}})(),faceToChar:function(f){var d=["/:^_^","/:^$^","/:Q","/:815","/:809","/:^O^","/:081","/:087","/:086","/:H","/:012","/:806","/:b","/:^x^","/:814","/:^W^","/:080","/:066","/:807","/:805","/:071","/:072","/:065","/:804","/:813","/:818","/:015","/:084","/:801","/:811","/:?","/:077","/:083","/:817","/:!","/:068","/:079","/:028","/:026","/:007","/:816",'/:\'""',"/:802","/:027","/:(Zz...)","/:*&*","/:810","/:>_<","/:018","/:>O<","/:020","/:044","/:819","/:085","/:812",'/:"',"/:>M<","/:>@<","/:076","/:069","/:O","/:067","/:043","/:P","/:808","/:>W<","/:073","/:008","/:803","/:074","/:O=O","/:036","/:039","/:045","/:046","/:048","/:047","/:girl","/:man","/:052","/:(OK)","/:8*8","/:)-(","/:lip","/:-F","/:-W","/:Y","/:qp","/:$","/:%","/:(&)","/:@","/:~B","/:U*U","/:clock","/:R","/:C","/:plane","/:075"];var e=d[parseInt(f,10)];if(e){e=e.replace("&gt;",">").replace("&lt;","<").replace("&amp;","&").replace("&apos;","'").replace("&quot;",'"').replace("&quot;",'"')}return e},getScript:function(e,p,i){var o=window.document,n=o.getElementsByTagName("head")[0]||o.documentElement,k=o.createElement("script").readyState?function(s,t){var r=s.onreadystatechange;s.onreadystatechange=function(){var u=s.readyState;if(u==="loaded"||u==="complete"){s.onreadystatechange=null;r&&r();t.call(this)}}}:function(r,s){r.addEventListener("load",s,false)},j=/\.css(?:\?|$)/i;var q=j.test(e),h=o.createElement(q?"link":"script"),g=p,l,m,f,d;if(c.isPlainObject(g)){p=g.onSuccess;l=g.onFailure;d=g.onTimeout;m=g.timeout;i=g.charset}if(q){h.href=e;h.rel="stylesheet"}else{h.src=e;h.async=true}if(i){h.charset=i}if(c.isFunction(p)){if(q){p.call(h)}else{k(h,function(){if(f){f.cancel();f=undefined}p.call(h);c.later(function(){n.removeChild(h);h=undefined},3000)})}}if(c.isFunction(d)){f=c.later(function(){f=undefined;d()},m||3000)}n.insertBefore(h,n.firstChild);return h},sendLog:function(d){var e="";if(c.UA.ie){e="ie"+c.UA.ie}else{if(c.UA.firefox){e="firefox"+c.UA.firefox}else{if(c.UA.chrome){e="chrome"+c.UA.chrome}else{if(c.UA.safari){e="safari"+c.UA.safari}else{if(c.UA.opera){e="opera"+c.UA.opera}}}}}c.later(function(){try{new Image().src="http://www.atpanel.com/ww?cache="+new Date().getTime()+"&browse="+e+"&"+d}catch(f){}},500)}}});TDog.add("EventCenter",function(p){var g=KISSY,e=p.EVENTS,h,j,r,b,c,i,k,a,q,n,m,f,o,d={init:function(){g.log("init EventCenter");h=p.Util;j=p.Config;r=p.Login;k=p.DataManager;a=p.DataManager.Message;c=p.WebServer;i=p.Daemon;b=p.LocalStorage;q=p.SysTips;n=p.SysMessage;m=p.StatusIcon;f=p.RecentList;o=p.ChatDialog}};g.mix(d,g.EventTarget);var l=function(s){return typeof s!=="string"||s===""};d.on(e.CLICK_STATUS_ICON,function(){g.log("\u70b9\u51fb\u72b6\u6001\u56fe\u6807");if(r.canTalk()){if(!f.isOpen()){m.online()}else{if(k.getTotalUnreadMsgCount()>0){m.getmessage()}}if(k.getTotalUnreadMsgCount()>0){if(!f.isOpen()){if(k.getTotalUnreadMsgCount()===1){d.fire(e.SHOW_CHAT_DIALOG,{haveUser:{userName:"donotknow"}});return false}}}return true}else{return false}});d.on(e.CLICK_LIGHT_ICON,function(t){g.log("\u70b9\u51fb\u4eae\u706f\u56fe\u6807");var s=t.userInfo;if(r.canTalk(s.key,true)){s.fromLight=true;d.fire(p.EVENTS.SHOW_CHAT_DIALOG,t)}});d.on(e.LOGIN_START,function(){if(p.Login.online==false){}else{m.onlogin();p.Login.online=false}});d.on(e.LOGIN_SUCCESS,function(){g.log("\u767b\u5f55\u6210\u529f");q.hide();p.Login.ready=false;var x=Light.lightedUsers,v,s;while(x.length){v=x.shift();g.log("\u81ea\u52a8\u6253\u5f00\u548c "+v+" \u7684\u804a\u5929\u7a97\u53e3");if(v){if(!(s=Light.data[v])){var w=g.unparam(location.search.substring(1)),u=w.touid||w.tid;if(u){s={key:v,userName:h.getUserName(u),userId:u,status:w.status||1,itemId:w.gid,subscribed:false}}Light.data[v]=s}if(s){s.fromLight=true;g.later(function(){d.fire(p.EVENTS.SHOW_CHAT_DIALOG,{userInfo:s})},1000)}}}var t=k.getTotalUnreadMsgCount();if(t>0){g.log("\u5b58\u5728\u672a\u8bfb\u6d88\u606f "+t);m.getmessage()}else{m.online()}});d.on(e.ERROR_LOGIN_FAILED,function(u){g.log("\u767b\u5f55\u5931\u8d25");var s=u.error||{},t=parseInt(s.code,10);if(t===-100||t===-101){r.directToTBLogin()}else{m.offline();q.show(p.ERROR_MESSAGE[t]||s.errorMessage||p.ERROR_MESSAGE[-1],200)}});d.on(e.SHOW_RECENT_LIST,function(s){g.log("\u6253\u5f00\u6700\u8fd1\u8054\u7cfb\u4eba");if(!p.DataManager.isLogin()){return}c.getTalkUsers();s.removeLoading()});d.on(e.SHOW_CHAT_DIALOG,function(v){g.log("\u6253\u5f00\u804a\u5929\u7a97\u53e3");if(v.haveUser&&v.haveUser.userName){c.startChat("","",{onSuccess:function(){g.log("\u83b7\u53d6\u5f00\u59cb\u804a\u5929\u6570\u636e\u5b8c\u6210\u3002")},onTimeout:function(){g.log("\u83b7\u53d6\u5f00\u59cb\u804a\u5929\u6570\u636e\u5931\u8d25","warn");q.show(p.ERROR_MESSAGE[-1000])}},false)}else{var s=v.userInfo||{},w=s.userName||"",u=s.userId||s.key||"",x=s.itemId||"";s.status=s.status||1;if((!w||l(w))&&(!u||l(u))){q.show("\u7f51\u7edc\u51fa\u73b0\u9519\u8bef\uff0c\u8bf7\u5237\u65b0\u3002",140,2);return}g.log("\u548c "+w+" \u5f00\u59cb\u804a\u5929 fromLight = "+s.fromLight);if(w==k.getNickName()){alert("\u4e0d\u80fd\u9009\u62e9\u81ea\u5df1\u54e6\u3002");return}if(s.fromLight){if(s.subscribed){var t=k.getUser(u);s.status=(t||{})["statusType"]||s.status||1}else{Light.data[s.key].subscribed=true}}p.ChatDialog.show(s,u.indexOf("cntaobao")===0);c.startChat(u,x,{onSuccess:function(){g.log("\u83b7\u53d6\u5f00\u59cb\u804a\u5929\u6570\u636e\u5b8c\u6210\u3002")},onTimeout:function(){g.log("\u83b7\u53d6\u5f00\u59cb\u804a\u5929\u6570\u636e\u5931\u8d25","warn");o.showSysTip("<p>"+p.ERROR_MESSAGE[-14]+"</p>",true)}},s.fromLight)}});d.on(e.RECEIVE_CHAT_MESSAGE,function(t){var s=t.unreadMsgPersonCount;g.log("\u6536\u5230"+s+"\u4e2a\u4eba\u7684\u6d88\u606f");if(f.isOpen()){f.update();o.isOpen()}else{d.fire(e.UPDATE_STATUS_ICON,{data:{mSize:s}})}});d.on(e.RECEIVE_SUBSCRIBE_MESSAGE,function(s){g.log("\u63a5\u6536\u5230\u7cfb\u7edf\u63d0\u9192");n.show(s.data)});d.on(e.RECEIVE_LOGINOUT_SIGNAL,function(s){g.log("\u63a5\u6536\u5230\u65fa\u65fa\u9000\u51fa\u901a\u77e5");m.offline();p.SysTips.hide();i.stop();p.NotifyDaemon.stop();k.clearAll();f.close();o.closeDialog()});d.on(e.UPDATE_USER_STATUS,function(s){g.log("\u66f4\u65b0\u7528\u6237\u72b6\u6001\u4fe1\u606f");var t=s.data;if(f.isOpen()){f.update()}if(o.isOpen()){o.updateUserStatus(h.getUserName(t.changedUserId),t.status)}});d.on(e.UPDATE_STATUS_ICON,function(t){var u=t.data,s;g.log("\u66f4\u65b0\u72b6\u6001\u56fe\u6807");if(u){s=u.mSize}else{s=k.getTotalUnreadMsgCount()}if(s>0){g.log("\u6709\u591a\u5c11\u4eba\u672a\u8bfb\uff1a "+s);m.getmessage()}else{m.online()}});d.on(e.ERROR_GET_CHAT_INFO,function(){o.showSysTip("<p>"+p.ERROR_MESSAGE[-1000]+"</p>",true)});d.on(e.SEND_MESSAGE,function(t){var s=t.content,u=t.userName;g.log("\u7ed9 "+u+" \u53d1\u9001\u4ee5\u4e0b\u6d88\u606f\uff1a"+s,"info");c.send(u,s,t.callback)});d.on(e.ERROR_GET_MESSAGE,function(u){g.log("\u53d6\u670d\u52a1\u7aef\u4fe1\u606f\u5931\u8d25");var s=u.error,t=parseInt(s.code,10);if(t===-100||t===-101){d.fire(e.RECEIVE_LOGINOUT_SIGNAL,{data:{subType:403}});i.stop();p.NotifyDaemon.stop()}else{q.show(p.ERROR_MESSAGE[t]||s.errorMessage||p.ERROR_MESSAGE[-1])}});d.on(p.EVENTS.DAEMON_FIRE,function(){c.get()});p.EventCenter=d});TDog.add("Login",function(c){var e=KISSY,b,d,a,f;c.Login={online:false,ready:false,init:function(){e.log("init Login");b=c.Config;d=c.DataManager;a=c.StatusIcon;f=c.SysTips},canTalk:function(h,g){if(!d.getNickName()){this.directToTBLogin(h);return false}if(a.isOffline()||!d.isLogin()){if(g){c.WebServer.login();f.showLoginTips(true)}else{f.showLoginTips(c.Login.ready)}if(h){Light.lightedUsers.push(h)}return false}return true},directToTBLogin:function(l){var m=location,j=m.protocol+"//"+m.host+m.pathname,i=m.search,k=m.hash,h=m.href,g=b.LIGHT_NICK;i=i?e.unparam(i.substring(1)):{};if(g in i){delete i[g]}if(l){if(this.isSearch()){i[g]=encodeURIComponent(l)}else{i[g]=l}}i=e.param(i);if(!this.isSearch()){i=encodeURIComponent(i)}h=j+"?"+i+k;m.href=b.tbLoginUrl+"?redirectUrl="+h},isSearch:function(){var g=["search.taobao.com","sandbox.search.taobao.com","search8.taobao.com","search8.daily.taobao.net","s.taobao.com"];if(e.indexOf(location.host,g)>-1){return true}}}});TDog.add("LocalStorage",function(m){var f=KISSY,d=m.Util,e=TStart,b=f.Cookie,c="x",g="otherx",j="whl",n=0,a=e.Config.DOMAIN,k,i={},l="_ato",h="__ll";m.LocalStorage={init:function(){i={};this.setCookieWHL("-1","0","0","0")},setItem:function(o,p){i[o]=p},getItem:function(o){return i[o]||{}},getItems:function(){var o=[];for(var p in i){o.push([p,i[p]])}return o},clear:function(){var o=f.unparam(b.get(c)),p=this;if(o[h]!="-1"||p.getCookieWHL().messageStatus===0){i={};p.setCookieWHL("-1","0","0","0");p.setCookieX(h,"-1");p.setCookieX(l,"0")}},getCookieX:function(o){return decodeURIComponent(f.unparam(b.get(d.isTaobao()?c:g))[o])},setCookieX:function(p,q){var r=f.unparam(b.get(c));r[p]=encodeURIComponent(q);var o=f.param(r);b.set(d.isTaobao()?c:g,o,365,a,"/")},setAndGetFocusTime:function(o){if(o){n=o}return n},setCookieWHL:function(p,r,s,o){var q=p+"&"+r+"&"+s+"&"+o;b.set(j,q,"",a,"/")},setPublicKey:function(o){k=o},getPublicKey:function(){return k||""},getCookieWHL:function(){var p=b.get(j),o=null;if(p){o=p.split("&");if(o.length!==4){o=[-1,0,0,0]}}else{o=[-1,0,0,0]}return{messageStatus:parseInt(o[0]),system:parseInt(o[1]),heartTime:parseInt(o[2]),focusTime:parseInt(o[3])}}}});TDog.add("DataManager",function(l){var h=KISSY,a=h.Cookie,o=h.JSON,e=l.Config,m=l.Util,f,i,c,d,k,b="x",g="",n={FIRST_RUN:"_first_run",LAST_LOGIN:"__ll",LAST_LOGIN_NAME:"_last_login_name",RECENT_LIST:"_recent_list",RECENT_LIST_NAME:"_recent_list_name",USER_LIST:"_user",MESSAGE_LIST:"_message_list"},j=l.EVENTS;l.DataManager={init:function(){var p=this,r,q;h.log("\u521d\u59cb\u5316 DataManager \u6a21\u5757");f=l.LocalStorage;i=l.EventCenter;c=l.WebServer;d=l.Daemon;k=p.Message;k.init()},getRecentList:function(){return f.getItem(n.RECENT_LIST)},getUser:function(p){var q=f.getItem(n.RECENT_LIST);if(q){return q[p]}return{}},setRecentList:function(r){var s=f.getItem(n.RECENT_LIST);for(var q=0;q<r.length;q++){var p=s[r[q].userId];s[r[q].userId]=r[q];if(p){r[q].messageTime=p.messageTime}}f.setItem(n.RECENT_LIST,s)},updateMessageTime:function(p,q){var r=f.getItem(n.RECENT_LIST);if(r&&r[p]){r[p].messageTime=q}},getMessageTime:function(p){var q=(this.getUser(p)||{})["messageTime"]||"";h.log("message time :"+q);return q},getTotalUnreadMsgCount:function(){var p=f.getCookieWHL();if(p.messageStatus){return p.messageStatus}return 0},saveStartChatData:function(s){if(s.success.toLowerCase()=="true"){var p=s.result,r=p.item||{},q=p.user;this.__checkOneUserMessage(p);this.__isTaobaoUser(q,r);this.__saveAndViewChatMessage(p);this.__updateNuberOfPeople(p)}else{if(s.result.error[0].code==-2){l.ChatDialog.closeDialog();l.SysTips.show(l.ERROR_MESSAGE[-2],150,3)}else{if(s.result.error[0].code==-14){l.SysTips.show(l.ERROR_MESSAGE[-14],0,true);this.forcedUpdateNumberOfPeople(e.NOTIFY_STATUS.notMessage.value,0)}else{if(s.result.error[0].code==-100||s.result.error[0].code==-101||s.result.error[0].code==-12){i.fire(l.EVENTS.RECEIVE_LOGINOUT_SIGNAL,{data:{subType:403}})}else{i.fire(j.ERROR_GET_CHAT_INFO,{data:s.result,method:"start"})}}}}},handleReceiveMessage:function(r){var q=this;if(r.success.toLowerCase()=="true"){var p=r.result;p.user={userChatId:p.talkUserStatus.userId};l.ChatDialog.updateUserStatus(p.talkUserStatus.userId,p.talkUserStatus.statusType);q.__saveAndViewChatMessage(p);q.__updateNuberOfPeople(p)}else{if(r.result.error[0].code==-2){l.ChatDialog.closeDialog();l.SysTips.show(l.ERROR_MESSAGE[-2],150,3)}else{if(r.result.error[0].code==-14){l.SysTips.show(l.ERROR_MESSAGE[-14],0,true);this.forcedUpdateNumberOfPeople(e.NOTIFY_STATUS.notMessage.value,0)}else{if(r.result.error[0].code==-100||r.result.error[0].code==-101||r.result.error[0].code==-12){i.fire(l.EVENTS.RECEIVE_LOGINOUT_SIGNAL,{data:{subType:403}})}else{i.fire(j.ERROR_GET_CHAT_INFO,{data:r.result,method:"start"})}}}}},clearAll:function(){l.ChatDialog.clearCurrentChatUserId();g="";f.clear()},getNickName:function(){var p=a.get("_nk_")||"";return unescape(p.replace(/\\u/g,"%u"))},getNickUrlComponent:function(){if(g.length==0){g=encodeURIComponent(unescape((a.get("_nk_")||"").replace(/\\u/g,"%u")))}return g},isLogin:function(){var p=this,r=!!p.getNickName(),q=f.getCookieX(n.LAST_LOGIN);return r&&(q==p.getCookieLastLoginTime())},getCookieLastLoginTime:function(){if(m.isTaobao()){return(h.unparam(a.get("uc1"))["lltime"]+a.get("lastgetwwmsg"))||"-1"}else{return(a.get("t")+a.get("login"))||"-1"}},setLastLoginTime:function(){f.setCookieX(n.LAST_LOGIN,this.getCookieLastLoginTime());f.setCookieWHL(0,0,new Date().getTime(),new Date().getTime())},resetLastLoginTime:function(){f.setCookieX(n.LAST_LOGIN,"0")},haveNotFocusedPage:function(){return f.setAndGetFocusTime()===f.getCookieWHL().focusTime},setNumberOfPeople:function(p,q){var r=f.getCookieWHL();if(r.messageStatus!=p){q=2|q}f.setCookieWHL(p,q,r.heartTime,r.focusTime)},forcedUpdateNumberOfPeople:function(p,q){var r=f.getCookieWHL();f.setCookieWHL(p,q,r.heartTime,r.focusTime)},setAndGetFocusTime:function(p){if(p){var q=f.getCookieWHL();f.setCookieWHL(q.messageStatus,q.system,q.heartTime,p);f.setAndGetFocusTime(p);return p}return f.setAndGetFocusTime()},addMessage:function(q,s){var r=f.getItem(n.MESSAGE_LIST);if(!r[q]){r[q]=s}else{for(var p=0;p<s.length;p++){if(!m.contains(r[q],s[p])){r[q].push(s[p])}}while(r[q].length>20){r[q].shift()}}},addAllMessage:function(q,r){var p=f.getItem(n.MESSAGE_LIST);p[q]=r;f.setItem(n.MESSAGE_LIST,p);while(r.length>20){r.shift()}},deleteMessage:function(p){var q=f.getItem(n.MESSAGE_LIST);if(q[p]){q[p]=[]}f.setItem(n.MESSAGE_LIST,q)},getAllMessages:function(p){return f.getItem(n.MESSAGE_LIST)[p]||[]},getHeartTime:function(){return f.getCookieWHL().heartTime},setHeartTime:function(q){var p=f.getCookieWHL();f.setCookieWHL(p.messageStatus,p.system,q,p.focusTime)},startHeartTime:function(q){var p=f.getCookieWHL();f.setCookieWHL(p.messageStatus,p.system,q,p.focusTime)},setMessageStatus:function(p,q){var r=f.getCookieWHL();f.setCookieWHL(p,q,r.heartTime,r.focusTime)},getCookieWHL:function(){return f.getCookieWHL()},setCookieWHL:function(q,r,s,p){f.setCookieWHL(q,r,s,p)},getLoginKey:function(){return f.getPublicKey()},setLoginKey:function(p){f.setPublicKey(p)},__checkOneUserMessage:function(p){if(p.talkUserStatus&&p.talkUserStatus.userId){var r=p.talkUserStatus;if(p.single){var q={userName:p.user.nick,userId:r.userId,relation:r.relation,status:r.statusType};l.ChatDialog.show(q,q.userId.indexOf("cntaobao")===0)}else{l.ChatDialog.updateUserStatus(p.user.nick,r.statusType)}}},__isTaobaoUser:function(p,q){if(p.userChatId.indexOf("cntaobao")===0){var r=q.title?{user:p,item:q}:{user:p};l.ChatDialog.showInfo(r)}},__saveAndViewChatMessage:function(p){var q=p.user;this.updateMessageTime(q.userChatId,p.timeStamp);if(p.messages&&p.messages.length){if(p.all){this.addAllMessage(q.userChatId,p.messages)}else{this.addMessage(q.userChatId,p.messages)}}l.ChatDialog.updateMsg()},__updateNuberOfPeople:function(p){this.forcedUpdateNumberOfPeople(p.size,0);if(p.size==0){i.fire(j.UPDATE_STATUS_ICON,{data:{mSize:0}})}else{i.fire(j.RECEIVE_CHAT_MESSAGE,{unreadMsgPersonCount:p.size})}},hash:function(){return[2,13,28,9,18,27,23,20,17,27,7,9,29,25,5,24]}}});TDog.add("DataManager.Message",function(l){var d=KISSY,c,e,b,i,h,a,k=l.DataManager,g=l.EVENTS,j=l.MESSAGE_SUBTYPE,f=l.MESSAGE_TYPE,m={LAST_LOGIN:"_last_login",SYSTEM_MESSAGE:"_system_message",HAS_NEW_MESSAGE:"_have_new_message"};if(!d.isPlainObject(k)){return}k.Message={init:function(){d.log("\u521d\u59cb\u5316 Message \u6a21\u5757");c=l.LocalStorage;e=l.EventCenter;b=l.Daemon;i=l.NotifyDaemon;a=l.WebServer;h=l.ChatDialog},saveGetData:function(o){var u=this,t,s,v,n=0;if(o.success.toLowerCase()=="true"){if(o.result.messages){v=o.result.messages;n=o.result.size;for(var p=0,r=v.length;p<r;p++){t=v[p];s=parseInt(t.subType,10);switch(parseInt(t.type,10)){case f.LOGOUT:d.log("\u6536\u5230\u9000\u51fa\u901a\u77e5\uff0c\u505c\u6b62\u8bf7\u6c42\u8f6e\u8be2","warn");e.fire(g.RECEIVE_LOGINOUT_SIGNAL,{data:t});return;break;case f.STATUS:var q=t.changedUserId||"";if(q){d.log("\u6536\u5230\u7528\u6237 "+q+" \u7684\u72b6\u6001\u66f4\u65b0\u4fe1\u606f");e.fire(g.UPDATE_USER_STATUS,{data:t})}break;case f.SYSTEM:switch(s){case j.SUBSCRIBE_MESSAGE:e.fire(g.RECEIVE_SUBSCRIBE_MESSAGE,{data:t});break;case j.POPUP_MESSAGE:e.fire(g.RECEIVE_POPUP_MESSAGE,{data:t});break}break;case f.OFFLINE:case f.SELF:case f.TALK:d.log("\u63a5\u53d7\u5230\u6b63\u5e38\u7684\u804a\u5929\u6570\u636e,ERROR`");break}}}}},checkCurrentUserMessage:function(n,p){var o=h.getCurrentChatUserId();if(o){a.receiveMessage(o,p,n);return true}return false},clearAll:k.clearAll}});TDog.add("Daemon",function(u){var h=KISSY,x=h.Event,j,k,b,c,n,l,q,t,v,r,f,m=false,e=false,d=800,o=1200;u.Daemon={init:function(){h.log("\u521d\u59cb\u5316 Daemon \u6a21\u5757");var y=this;j=u.Util;k=u.EventCenter;b=u.LocalStorage;c=u.WebServer;n=u.DataManager;l=u.Config;q=u.StatusIcon;v=u.SysTips;t=u.NotifyDaemon;r=u.ChatDialog;f=u.EVENTS;y._bindEvent()},start:function(){var y=this;e=true;m=true;n.setAndGetFocusTime(new Date().getTime());y.fire()},fire:function(){try{var z=this;if(z.timer){z.timer.cancel()}var y=r.isOpen()?d:o,B=null;if(e&&m){B=n.getCookieWHL();if(B.system>0){n.setCookieWHL(B.messageStatus,0,B.heartTime,B.focusTime);if((B.system&1)==1){k.fire(f.DAEMON_FIRE)}if((B.system&2)==2){n.Message.checkCurrentUserMessage(false,true)}}}else{if(z.notHaveFocusedPage()){B=n.getCookieWHL();if((B.system&2)==2){n.setCookieWHL(B.messageStatus,0,B.heartTime,B.focusTime);n.Message.checkCurrentUserMessage(false,false)}}}z.execute(B,y)}catch(A){h.log("\u8f6e\u8be2\u51fa\u9519\u4e86\u3002");if(z.timer){z.timer.cancel()}z.timer=h.later(function(){z.fire()},d)}},execute:function(A,z){var y=this;if(l.NOTIFY_STATUS.logout.value==A.messageStatus){k.fire(f.RECEIVE_LOGINOUT_SIGNAL,{data:{subType:403}});return}else{if(A.messageStatus>0){if((!r.isOpen())&&(!q.onNewMessage())){k.fire(f.RECEIVE_CHAT_MESSAGE,{unreadMsgPersonCount:A.messageStatus})}}}y.timer=h.later(function(){y.fire()},z)},stop:function(){var y=this;if(e){h.log("\u505c\u6b62\u672c\u5730\u8f6e\u8be2\u3002");if(y.timer){y.timer.cancel()}e=false}},notHaveFocusedPage:function(){return n.haveNotFocusedPage()},isFocused:function(){return m},_bindEvent:function(){var y=this,z=window;m=true;n.setAndGetFocusTime(new Date().getTime());x.on(z,"focus",function(){h.log("\u5f53\u524d\u7a97\u53e3\u83b7\u5f97\u7126\u70b9");m=true;if(n.isLogin()){if(m){if(!y.notHaveFocusedPage()){n.setAndGetFocusTime(new Date().getTime());n.Message.checkCurrentUserMessage(false,true)}else{n.Message.checkCurrentUserMessage(true,true)}y.start();t.restart();v.hide();k.fire(f.RECEIVE_CHAT_MESSAGE,{unreadMsgPersonCount:n.getTotalUnreadMsgCount()})}}else{k.fire(u.EVENTS.RECEIVE_LOGINOUT_SIGNAL,{data:{subType:403}})}});x.on(z,"blur",function(){h.log("\u5f53\u524d\u7a97\u53e3\u5931\u53bb\u7126\u70b9\u3002");m=false})}};var a=7000,s=false,w=-9,p=15000,i=1,g=undefined;u.NotifyDaemon={init:function(){var y=this;y.restart();h.log("\u521d\u59cb\u5316\u957f\u8fde\u63a5\u90e8\u4efd.")},start:function(){var y=this;s=true;n.startHeartTime(w);y.__createConnection();h.log("\u767b\u5f55\u5b8c\u6210\uff0c\u5f00\u59cb\u957f\u8fde\u63a5.")},restart:function(){var y=this;s=true;y.__heartTimeout()},stop:function(){var y=this;if(s){h.log("\u505c\u6b62\u5916\u90e8\u957f\u94fe\u63a5\u68c0\u67e5\u3002");if(y.heartTimeoutTimer){y.heartTimeoutTimer.cancel()}s=false}},__createConnection:function(){var z=this;try{g=document.createElement("iframe");g.width=0;g.height=0;g.style.display="none";g.src=l.notifyUrl;var y=document.getElementsByTagName("body")[0];y.appendChild(g,y.lastChild)}catch(A){h.log("\u8fdc\u7a0b\u8fde\u63a5\u5f02\u5e38\u4e86\u2026\u2026"+A)}},__heartTimeout:function(){var y=this;if(y.heartTimeoutTimer){y.heartTimeoutTimer.cancel()}if(s){y.heartTimeoutTimer=h.later(function(){var z=n.getCookieWHL();h.log("\u68c0\u67e5\u957f\u94fe\u63a5\uff0c\u91cd\u65b0\u5f00\u59cb:"+(new Date().getTime()-z.heartTime>a)+","+(new Date().getTime()-z.heartTime)+","+new Date().getTime()+","+z.heartTime);if(z.heartTime==w||(new Date().getTime()-z.heartTime>a&&z.heartTime!==w&&z.messageStatus!==l.NOTIFY_STATUS.logout.value)){if(g){h.log("\u957f\u94fe\u63a5\u7684frame\u5df2\u7ecf\u5b58\u5728\u3002");g.src=l.notifyUrl}else{y.__createConnection();h.log("\u957f\u94fe\u63a5\u7684frame\u4e0d\u5df2\u7ecf\u5b58\u5728\u3002")}n.setHeartTime(w);s=true;y.__checkConnection()}y.__heartTimeout()},a)}},__checkConnection:function(){var y=this;if(i++<4){h.later(function(){if(n.getHeartTime()===w){if(g){h.log("\u957f\u94fe\u63a5\u7684frame\u5df2\u7ecf\u5b58\u5728\u3002");g.src=l.notifyUrl}else{y.__createConnection();h.log("\u957f\u94fe\u63a5\u7684frame\u4e0d\u5df2\u7ecf\u5b58\u5728\u3002")}}},p)}}}});TDog.add("WebServer",function(m){var f=KISSY,d=m.Config,l=m.DataManager,i=m.EVENTS,g=m.EventCenter,c=m.Daemon,h=0,j=5000,e=m.SITES,k=e.TAOBAO,a=1,b=0,n={login:{url:d.loginUrl,callback:"TDog.WebServer.prepareLogin"},checkautologin:{url:d.checkAutoLogin,callback:"TDog.WebServer.decideAutoLogin"},getloginresult:{url:d.getLoginResultUrl,callback:"TDog.WebServer.disposeLoginResult"},setstrangermsg:{url:d.setAutoLoginUrl,callback:"TDog.WebServer.setStrangerMsgData"},clearchatlist:{url:d.clearListUrl,callback:"TDog.WebServer.clearChatListData"},clearchatmessage:{url:d.clearListUrl,callback:"TDog.WebServer.handClearChatMessage"},setautologin:{url:d.setAutoLoginUrl,callback:"TDog.WebServer.setAutoLoginData"},start:{url:d.startUrl,callback:"TDog.DataManager.saveStartChatData"},receive:{url:d.startUrl,callback:"TDog.DataManager.handleReceiveMessage"},send:{url:d.sendUrl,callback:"TDog.WebServer.handleSendResult"},get:{url:d.getUrl,callback:"TDog.DataManager.Message.saveGetData"},getTalkUsers:{url:d.getTalkUsers,callback:"TDog.WebServer.handleTalkUsers"},ackGetMessage:{url:d.ackGetMessage,callback:"TDog.WebServer.handleAckResult"},checkUserSeting:{url:d.ackGetMessage,callback:"TDog.WebServer.handUserSeting"},getServerKey:{url:d,callback:"TDog.WebServer.handleLoginFirst"}};m.WebServer={AUTO_LOGIN:{autoLoginAndTip:1,autoLoginNotTip:2,forcedLogin:3},init:function(){var o=this;f.log("\u521d\u59cb\u5316 WebServer \u6a21\u5757");c.init();if(l.isLogin()){g.fire(i.LOGIN_SUCCESS);m.NotifyDaemon.init();c.start()}else{if(l.getNickName()){m.LocalStorage.init();o.checkAutoLogin()}else{m.LocalStorage.init();f.log("\u963f\u91cc\u65fa\u65fa\uff08\u672a\u767b\u5f55\uff09");m.SysTips.setHoverTips("\u963f\u91cc\u65fa\u65fa\uff08\u672a\u767b\u5f55\uff09")}}},_request:function(o,r){var q=l.getNickUrlComponent(),p=q.length==0?"":"&nkh="+q;o=o+p+"&appId="+d.appId;f.log("["+(new Date())+"] "+o+"&t="+ +new Date,"info");if(f.isFunction(r.onFailure)){r.onFailure=r.onTimeout}m.Util.getScript(o+"&t="+ +new Date,{onSuccess:function(){if(f.isFunction(r.onSuccess)){r.onSuccess.call(this)}},onFailure:function(){if(f.isFunction(r.onFailure)){r.onFailure.call(this)}},onTimeout:function(){if(f.isFunction(r.onTimeout)){r.onTimeout.call(this)}},success:function(){if("function"===typeof r.onSuccess){r.onSuccess.call(this)}},error:function(){if("function"===typeof r.onFailure){r.onFailure.call(this)}},scope:this,charset:d.charset||"gbk",timeout:j})},sitePrefix:(function(){var p=[],q="";for(var o in e){p.push(e[o])}return new RegExp("^("+p.join("|")+")(.*)$","i")})(),formatNick:function(q){var o=this,p=o.sitePrefix;if(p.test(q)){return q}return k+q},getNick:function(r){if(!r){return}var o=this,q=o.sitePrefix,p=r.match(q);if(p){return("undefined"!=typeof p[2]&&p[2])?p[2]:r}return r},setAutoLogin:function(p){var o=this,r="setautologin",q=f.param({callback:n[r]["callback"]});o._request(d.setAutoLoginUrl+"?act="+p+"&"+q,{})},setAutoLoginData:function(o){this.__handleErrorResult(o)},setStrangerMsg:function(p){var o=this,r="setstrangermsg",q=f.param({callback:n[r]["callback"]});o._request(d.setAutoLoginUrl+"?act="+p+"&"+q,{})},setStrangerMsgData:function(o){this.__handleErrorResult(o)},clearChatList:function(){var o=this,q="clearchatlist",p=f.param({callback:n[q]["callback"]});o._request(d.clearListUrl+"&"+p,{})},clearChatListData:function(o){this.__handleErrorResult(o)},clearChatMessage:function(o){var p=this,r="clearchatmessage",q=f.param({act:1,targetNick:o,callback:n[r]["callback"]});p._request(d.clearUrl+"?"+q,{})},handClearChatMessage:function(o){this.__handleErrorResult(o)},checkAutoLogin:function(r){var o=this,q="checkautologin",p=f.param({callback:n[q]["callback"],check:"1"});o._request(d.checkAutoLoginUrl+"?cat=-1&"+p,r||{})},checkUserSeting:function(r){var o=this,q="checkUserSeting",p=f.param({callback:n[q]["callback"]});o._request(d.checkAutoLoginUrl+"?cat=-1&"+p,r||{})},handUserSeting:function(s){var p=this;p.__handleErrorResult(s);if(s.success.toLowerCase()==="true"){var o=s.result,r=!(8192&parseInt(o.tag,10)),q=(16384&parseInt(o.tag,10));if(r){f.get("#tstart .tstart-settings-login").checked=true}else{f.get("#tstart .tstart-settings-login").checked=false}if(q){f.get("#tstart .tstart-settings-msg").checked=true}else{f.get("#tstart .tstart-settings-msg").checked=false}}},decideAutoLogin:function(s){var p=this;p.__handleErrorResult(s);if(s.success.toLowerCase()==="true"){if(s.result.tag==-1){p.__completeLogin()}else{var o=s.result,r=!(8192&parseInt(o.tag,10)),q=m.Config.forceAutoLogin;if(r&&f.UA.ie){p.login(p.AUTO_LOGIN.autoLoginNotTip)}else{if(q){f.log("\u6ee1\u8db3\u81ea\u52a8\u767b\u5f55\u6761\u4ef6\uff0c\u53d1\u8d77\u767b\u5f55\u8bf7\u6c42");p.login()}else{f.log("\u4e0d\u6ee1\u8db3\u81ea\u52a8\u767b\u5f55\u6761\u4ef6")}}}}},prepareLogin:function(q){var o=this;if("false"==q.success.toLowerCase()){var p=parseInt((q.result.error[0]||{})["code"])||0;switch(p){case -15:m.SysTips.showClientOnlineTips();m.Util.sendLog("wwweblog=logged");break;case -16:break;default:g.fire(i.ERROR_LOGIN_FAILED,{error:q.result.error[0]})}}else{o.getLoginResult()}},getLoginResult:function(){var o=this;f.log("\u767b\u5f55\u6210\u529f\uff0c\u8fc7 1 \u79d2\u949f\u83b7\u53d6\u767b\u5f55\u540e\u7684\u7ed3\u679c");f.later(function(){var p=f.param({time:a,callback:n.getloginresult["callback"]});o._request(d.getLoginResultUrl+"?"+p,{onSuccess:function(){f.log("\u4e8c\u6b21\u8bf7\u6c42\u5f97\u5230\u767b\u5f55\u7ed3\u679c\u767b\u5f55\u5b8c\u6210");if(l.isLogin()){o.get();m.NotifyDaemon.start();c.start();g.fire(i.LOGIN_SUCCESS);m.SysTips.show("\u963f\u91cc\u65fa\u65fa - "+l.getNickName()+"(\u5728\u7ebf)","150",5);h=new Date().getTime();a=1}},onFailure:function(){g.fire(i.RECEIVE_LOGINOUT_SIGNAL,{data:{subType:403}})},onTimeout:function(){g.fire(i.RECEIVE_LOGINOUT_SIGNAL,{data:{subType:403}})}})},a*1000)},disposeLoginResult:function(p){var o=this;f.log("\u767b\u5f55:"+p.success);if(p.success.toLowerCase()==="true"){l.setLastLoginTime()}else{if(++a<4&&p.result.error&&p.result.error[0].code==-99){o.getLoginResult()}else{a=1;l.resetLastLoginTime();g.fire(i.ERROR_LOGIN_FAILED,{error:(p.result.error||[])[0]})}}},login:function(q,t){var o=this,s="login",r,p=o.__encrypt();if(p){r=f.param({callback:n[s]["callback"],nickName:l.getNickName(),autoLogin:q||o.AUTO_LOGIN.autoLoginAndTip,loginTag:p});g.fire(i.LOGIN_START);f.log("\u8bf7\u6c42\u767b\u5f55\u5f00\u59cb");o._request(d.loginUrl+"?"+r,t||{})}},startChat:function(q,s,u,p){var o=this,t="start",r;r=f.param({callback:n[t]["callback"],userId:q,itemId:s||"",fromLight:p?"true":"false",time:l.getMessageTime(q)});o._request(d.startUrl+"?"+r,u||{})},receiveMessage:function(r,o,q,u){var p=this,t="receive",s;s=f.param({callback:n[t]["callback"],targetUserChatId:r,focused:o,update:q,time:l.getMessageTime(r)});p._request(d.receiveUrl+"?"+s,u||{})},send:function(p,q,s){var o=this,r;if(!p.length||!q.length){return}p=o.formatNick(p);r=f.param({callback:n.send["callback"],userId:p,content:q});o._request(d.sendUrl+"?"+r,s||{})},handleSendResult:function(o){this.__handleErrorResult(o)},get:function(r){var o=this,q="get",p;f.log("\u8f6e\u8be2\u83b7\u53d6\u4fe1\u606f");p=f.param({callback:n[q]["callback"]});o._request(d.getUrl+"?"+p,{})},getTalkUsers:function(r){var o=this,q="getTalkUsers",p=f.param({callback:n[q]["callback"]});o._request(d.getTalkUsers+"?"+p,r||{});f.log("\u53d6\u804a\u5929\u4eba\u5217\u8868\u3002")},handleTalkUsers:(function(){var o=1;return function(p){var q=m.WebServer.__handleErrorResult(p);if(p.success=="true"){f.log("\u66f4\u65b0\u8054\u7cfb\u4eba\u5217\u8868\u6210\u529f\uff1a"+o);m.RecentList.updateRecentlist(p.result.person);if(p.result.person.length>0){l.setRecentList(p.result.person)}l.forcedUpdateNumberOfPeople(p.result.size,0)}else{if(o++<4&&!q){f.log("\u66f4\u65b0\u8054\u7cfb\u4eba\u5217\u8868\u5931\u8d25\uff0c\u91cd\u8bd5\uff1a"+o);m.WebServer.getTalkUsers({})}else{f.log("\u66f4\u65b0\u8054\u7cfb\u4eba\u5217\u8868\u5931\u8d25\uff0c\u91cd\u8bd5\u4e09\u6b21\u6216\u9000\u51fa\u767b\u5f55\u7ed3\u675f\u3002")}}}})(),ack:function(q,p,s){var o=this,r;r=f.param({callback:n.ackGetMessage["callback"],userId:q,num:p});o._request(d.ackGetMessage+"?"+r,s||{})},handleAckResult:function(o){f.log("\u6536\u5230\u6d88\u606f\u5e94\u7b54:"+o.success);this.__handleErrorResult(o)},__handleErrorResult:function(o){if(o.success==="false"){if(o.result.error[0]){if(o.result.error[0].code==-100||o.result.error[0].code==-101||o.result.error[0].code==-12){g.fire(m.EVENTS.RECEIVE_LOGINOUT_SIGNAL,{data:{subType:403}});return true}}}return false},__encrypt:function(){var o=this,p=l.getLoginKey();if(p.length){return o.__encryptKey()}o.__getServerKey()},__getServerKey:function(){var o=this,q="getServerKey",p;p=f.param({callback:n[q]["callback"]});o._request(d.TagKeyUrl+"?"+p,{})},__encryptKey:function(){var u=[],o="",q=this;var t=l.getLoginKey();var s=q.__make();for(var r=0;r<s.length;r++){o+=t.charAt(s[r])}var p=encodeURIComponent(l.getNickName()).charAt(2);return p+o},handleLoginFirst:function(p){var o=this;if(p.success=="true"){l.setLoginKey(p.result.tagKey);if(b++<3){o.login()}}else{g.fire(i.ERROR_LOGIN_FAILED,{error:p.result.error[0]})}},__make:function(){var r=[];var q=l.hash();var o=d.hash;for(var p=0;p<16;p++){r.push(Math.floor((q[p])+(o[p])/7.3*100)%32)}f.log("hash:"+r.join(","));return r},__completeLogin:function(){f.log("\u5df2\u7ecf\u767b\u5f55\u8fc7\u540e\uff0c\u5b8c\u6210\u767b\u5f55\u3002");l.setLastLoginTime();if(l.isLogin()){this.get();m.NotifyDaemon.start();c.start();g.fire(i.LOGIN_SUCCESS);h=new Date().getTime();a=1}},uptime:function(){return h}}});TDog.add("RecentList",function(h){var e=KISSY,k=e.DOM,j=e.Event,l=h.DataManager,b=h.EventCenter,g,i=h.Util,d,a,c='<div class="tdog-recentlist"><ul>{ITEMS}</ul></div>',f='<li class="tdog-recentlist-item tdog-status-{status}"><i></i><span class="tdog-user-name" id="{userId}">{userName}</span><span class="tdog-msg-count">{msgCount}</span></li>';h.RecentList={init:function(){d=h.hostEl;g=h.ChatDialog;a=e.get(".tstart-drop-panel-bd",h.hostEl);this._bindUI()},update:function(){h.WebServer.getTalkUsers()},updateRecentlist:function(p){var o,m=p.length,n="";e.log("\u66f4\u65b0\u8054\u7cfb\u4eba\u5217\u8868");if(m===0){n='<p class="tdog-recentlist-none">\u6682\u65e0\u8054\u7cfb\u4eba</p>';k.addClass(e.get(".tstart-drop-panel-clearbtn",h.hostEl),"hidden")}else{k.removeClass(e.get(".tstart-drop-panel-clearbtn",h.hostEl),"hidden")}for(o=m-1;o>=0;--o){if(p[o].size==0||p[o].size==undefined||p[o].userId==g.getCurrentChatUserId()){p[o].size=""}else{p[o].size="("+p[o].size+")"}p[o].userName=h.Util.getUserName(p[o].userId);p[o].status=p[o].statusType;n+=i.substitute(f,{status:h.USER_STATUS[p[o].status][0],userName:i.getUserName(p[o].userId),msgCount:p[o].size,userId:p[o].userId})}n=c.replace("{ITEMS}",n);a.innerHTML=n},close:function(){k.removeClass(h.hostEl,"tstart-item-active");if(h.DataManager.isLogin()&&l.getTotalUnreadMsgCount()>0){h.StatusIcon.getmessage()}},isOpen:function(){return k.hasClass(d,"tstart-item-active")},_bindUI:function(){var n=function(p){var o=p.target;if(o.parentNode.nodeName.toUpperCase()=="LI"){o=o.parentNode}if(o.nodeName.toUpperCase()=="LI"){return o}return false},m;j.on(a,"click",function(q){m=n(q);if(m){var p=e.get(".tdog-user-name",m).id;if(h.ChatDialog.checkDialogOpen(p)){return}var o=l.getUser(p);if(o){b.fire(h.EVENTS.SHOW_CHAT_DIALOG,{userInfo:o});e.get(".tdog-msg-count",m).innerHTML=""}}});j.on(a,"mouseover mouseout",function(o){m=n(o);if(m&&m.getAttribute("current")!="true"){k.toggleClass(m,"tdog-recentlist-hover")}});j.on(a,"mousedown mouseup",function(o){m=n(o);if(m){k.toggleClass(m,"tdog-recentlist-select")}});j.on(window,"click",function(){if(l.isLogin()&&l.getTotalUnreadMsgCount()>0){h.StatusIcon.getmessage()}})}}});TDog.add("ChatDialog",function(r){var h=KISSY,t=h.DOM,u=h.Event,e=TStart,i=encodeURIComponent,c=r.EventCenter,a=r.WebServer,n=r.Config,k=r.Util,v=document,g=window,b=e.Config.DOMAIN,o=e.Config.isOnline,q=[],l,m,s,d,p=null,j=null,f='<div class="tdog-popup tdog-popup-blue '+(h.UA.ie?"tdog-ie":"")+'" style="width:416px;bottom:40px;overflow:normal;"><div class="tdog-popup-head" ><div><i class="tdog-status-"></i><div><span class="tdog-popup-contact"></span></div></div><span class="tdog-popup-tools"><span title="\u5e2e\u52a9" class="tdog-popup-help"></span><span title="\u5173\u95ed" class="tdog-popup-close"></span></span></div><div class="tdog-popup-main"><div class="tdog-popup-talkleftouter"><div class="tdog-popup-talkleftinner"><div class="tdog-popup-talkcontainer"><div class="tdog-popup-talkhistory"></div><div class="tdog-popup-talkbar">    <span title="\u8868\u60c5"></span>    <span class="tdog-popup-talkbar-clear" title="\u6e05\u7a7a\u804a\u5929\u8bb0\u5f55"></span>    <a title="\u804a\u5929\u8bb0\u5f55" href="#" target="_blank"><i></i>\u804a\u5929\u8bb0\u5f55</a></div><div class="tdog-popup-talkinput">    <textarea cols="5"></textarea></div><a title="\u9690\u85cf\u53f3\u8fb9\u680f" class="tdog-popup-pulloff" href="javascript:void(0);"><span></span></a></div><div class="tdog-popup-talkfoot">   <span><a class="tdog-popup-tms-link" href='+n.downloadWangWangURLBuy+'                target="_blank">\u963f\u91cc\u65fa\u65fa2011\u62a2\u5148\u4e0b\u8f7d</a></span>   <span class="tdog-popup-sendbut">     <span class="tdog-popup-send">\u53d1\u9001</span>     <span class="tdog-popup-changesend"></span><ul><li><i></i><span>\u6309Ctrl+Enter\u53d1\u9001</span></li><li class="tdog-send-mode"><i></i><span>\u6309Enter\u53d1\u9001</span></li></ul></span></div></div></div><div class="tdog-popup-talkright"></div><div class="tdog-popup-clear"></div></div><div class="tdog-popup-handle"></div><div class="tdog-popup-handle-x"></div><div class="tdog-popup-handle-y"></div></div>';r.ChatDialog={init:function(){},showAdLink:function(y,w){var x=h.get("a.tdog-popup-tms-link",w);if(x&&y.href&&y.title){x.innerHTML=y.title;t.attr(x,"href",y.href);p=y}},showBulletin:function(w){h.later(function(){var y=h.get("div.tdog-popup-tms-bulletin",m),x=h.get("div.tdog-popup-talkhistory",m);if(y&&w.title&&w.url&&w.href){var z=v.createElement("div");z.className="tdog-popup-tms-bulletin-close";y.innerHTML="<i></i><a href="+w.url+" target='_blank'>"+w.title+"</a>";y.appendChild(z);if(w.href=="taobao"&&b=="taobao.com"){t.css(y.parentNode,"display","block")}else{if(w.href=="daily"&&b=="daily.taobao.net"){t.css(y.parentNode,"display","block")}}j=w}if(x){x.scrollTop=x.scrollHeight}},800,false)},_create:function(y){var w=a.formatNick(d.userId),J=this;if(!y){var A='<a title="\u9690\u85cf\u53f3\u8fb9\u680f" class="tdog-popup-pullon" style="display:none"></a></div></div><div class="tdog-popup-talkright" ></div>',I,B;I=f.replace(A,"</div></div>");l=t.create(I);t.css(l,"width","253px");B=h.get("div.tdog-popup-talkleftinner",l);t.css(h.get("div.tdog-popup-talkright",l),"display","none");t.css(B,"margin-right","6px");t.css(h.get("div.tdog-popup-talkhistory",l),"width","auto")}else{l=t.create(f)}q.push(new Array(w,l));h.get("#tstart").appendChild(l);if(!y){h.get("a.tdog-popup-pulloff").style.display="none"}t.css(l,"display","block");this._bindUI(l);var E=h.get("div.tdog-popup-talkbar",l).getElementsByTagName("a")[0],D=i(i(i(r.DataManager.getNickName()))),x=i(i(i(w))),G="http://www2.im.alisoft.com/webim/online/chat_record_search.htm?from_im=webwangwang&signmode=im&type=0&u_id=cntaobao"+D+"&t_id="+x+"&sign_account="+D;if(E){E.href="http://sign.im.alisoft.com/sign/aso?domain=taobao&target="+G+"&_input_charset=utf-8"}var z=new h.Drag(l,{handle:".tdog-popup-head",not:[".tdog-popup-help",".tdog-popup-close"],scroll:true});z.onStartDrag=function(L,K){t.css(K,"bottom","auto")};u.on(h.get("div.tdog-popup-head",l),"selectstart",function(K){K.halt()});DragFn=function(R,O,N,U,T,X){var W=X,S=h.get("div.tdog-popup-talkhistory",W),L=h.get("div.tdog-popup-talkright",W),P=h.get("div.tdog-popup-main",W),M=h.get("a.tdog-popup-pulloff",W),V=h.get("span.tdog-popup-sendbut",W),K=h.get("a.tdog-popup-pullon",W),Q=O.offsetHeight-141+"px";if(t.hasClass(W,"tdog-popup-visible")){t.removeClass(W,"tdog-popup-visible")}t.css(S,"width","auto");t.css(S,"marginRight","5px");t.css(P,"height",O.offsetHeight-28+"px");if(t.css(L,"display")!=="none"){t.css(L,"height",O.offsetHeight-37+"px")}t.css((function(){return(M?[M,S]:[K,S])})(),"height",Q);if(6===h.UA.ie){t.addClass(V,"reflow-fix");t.removeClass(V,"reflow-fix")}};var H=new h.Drag(l,{resize:true,handle:".tdog-popup-handle",resizefn:[417,291]});H.onStartDrag=function(N,M,K){var L=h.get("div.tdog-popup-talkright",l);K.resizefn=(t.css(L,"display")==="none")?[270,291]:[417,291]};H.onDrag=function(P,N,L,K,Q,M){var O=M;DragFn(P,N,L,K,Q,M)};var F=new h.Drag(l,{resize:true,handle:".tdog-popup-handle-x",resizefn:[false,291]});F.onDrag=function(P,N,L,K,Q,M){var O=M;DragFn(P,N,L,K,Q,M)};var C=new h.Drag(l,{resize:true,handle:".tdog-popup-handle-y",resizefn:[417,false]});C.onStartDrag=function(Q,O,L,K,R,M){var P=M,N=h.get("div.tdog-popup-talkright",P);L.resizefn=(t.css(N,"display")==="none")?[270,false]:[417,false]};C.onDrag=function(O,N,L,K,P,M){DragFn(O,N,L,K,P,M)};return l},show:function(B,A){d=B;var x=a.formatNick(d.userId),F,D,y=false;for(var C=0;C<q.length;C++){if(q[C][0]==x){q[C][1].style.display="block";m=q[C][1];y=true}else{q[C][1].style.display="none"}}if(!y){m=this._create(A);F=t.viewportWidth();D=(F-440)/2;m.style.left=D+"px"}var E=h.get("div.tdog-popup-head",m),z,G=h.get("div",E);if(d.status){z=" - "+r.USER_STATUS[B.status][1]}else{z=""}var w=d.relation?"\u597d\u53cb":"\u964c\u751f\u4eba";G.innerHTML='<i></i><div class="tdog-contact-info"><span class="tdog-popup-contact">'+d.userName+"</span>"+z+"</div>";G.className="tdog-status-"+r.USER_STATUS[B.status][0];this.changeBut()},closeDialog:function(){k.css([[m,"display","none"],["tdog-face-container","display","none"]]);m=false;d=""},showInfo:function(B){var G=h.get("div.tdog-popup-talkright",m),w=(n.appId==1);if(!G){return}if(!w&&B.item&&B.item.id){var H=B.item,F='<div class="tdog-popup-goodsinfo"><p class="tdog-goodsinfo-head">\u5b9d\u8d1d\u63cf\u8ff0</p><div><div class="tdog-goodsinfo-pic"><p class="tdog-goodsinfo-img"><a href="http://item.taobao.com/item_detail-null-'+H.id+'.jhtml"  target = "_blank"><img src="'+H.imageUrl+'_80x80.jpg" title="'+H.title+'"/></a></p></div></div><p class="tdog-goodsinfo-title"><a href="http://item.taobao.com/item_detail-null-'+H.id+'.jhtml"  target = "_blank">'+H.title+'</a></p><p class="tdog-goodsinfo-price">\u4e00\u53e3\u4ef7\uff1a<span>'+H.price+'</span>\u5143</p><p><a href="http://buy.taobao.com/auction/buy_now.jhtml?auction_id='+H.id+'" title="\u7acb\u523b\u8d2d\u4e70" class="tdog-goodsinfo-linkbuy" target = "_blank"></a></p></div>';t.css(G,"background-image","none");G.innerHTML=F}else{if(B.user&&B.user.nick){var z={nick:"",sex:"\u4fdd\u5bc6",from:"\u4fdd\u5bc6",registDate:"",visitDate:"\u6ca1\u6709\u767b\u5f55",sellNum:"",buyNum:"",certification:"",relation:""};z=h.merge(z,B.user);switch(z.sex){case 1:z.sex="\u7537";break;case 2:z.sex="\u5973";break;default:z.sex="\u4fdd\u5bc6";break}var D=z.sellNum,y=z.buyNum,A=(z.certification=="true");if(D!=0){D='<img align="absmiddle" title="\u5356\u5bb6\u4fe1\u7528\u79ef\u5206" src="http://a.tbcdn.cn/sys/common/icon/rank/b_'+z.sellNum+'.gif" />'}if(y!=0){y='<img align="absmiddle" title="\u4e70\u5bb6\u4fe1\u7528\u79ef\u5206" src="http://a.tbcdn.cn/sys/common/icon/rank/c_'+z.buyNum+'.gif" />'}if(A){A='<img align="absmiddle" title="\u6dd8\u5b9d\u8ba4\u8bc1\u5546\u6237" src="http://a.tbcdn.cn/sys/common/icon/trade/mall_auth.png" />'}var x="";if(B.user.suspended==3){x='<p class="tdog-userinfo-suspended">\u8be5\u7528\u6237\u5df2\u7ecf\u88ab\u67e5\u5c01</p>'}var C='<div class="tdog-popup-userinfo">'+x+'<p class="tdog-userinfo-username">'+z.nick+'</p><p>\u6765\u81ea\uff1a<span class="tdog-popup-userinfo-from">'+z.from+"</span><br/> \u6027\u522b\uff1a"+z.sex+"</p><p>\u6ce8\u518c\u65f6\u95f4\uff1a"+z.registDate.split(" ")[0]+"</p><p>\u4e0a\u6b21\u767b\u5f55\uff1a"+z.visitDate.split(" ")[0]+"</p>"+(D!=""?"<p>\u5356\u5bb6\uff1a"+D+"</p>":"")+(y!=""?"<p>\u4e70\u5bb6\uff1a"+y+"</p>":"")+(A?"<p>\u8ba4\u8bc1\uff1a"+A+"</p>":"")+"</div>";t.css(G,"background-image","none");G.innerHTML=C;z.relation==1?(z.relation="\u597d\u53cb"):(z.relation="\u964c\u751f\u4eba");var E=h.get("div.tdog-popup-head",m);G=h.get("div",E);G.innerHTML=G.innerHTML.replace(/\u964c\u751f\u4eba/,z.relation)}}},checkDialogOpen:function(w){if(d){return a.formatNick(w)==a.formatNick(d.userName)}},isOpen:function(){return !!m},getTargetUser:function(){return d.userName},updateUserStatus:function(B,w){if(a.formatNick(d.userName)!=a.formatNick(B)){return}var y=h.get("div.tdog-popup-head",m),C=h.get("div",y),A="",x,z=/\u597d\u53cb/;w=r.USER_STATUS[w];if(w[1]!=""){A=" - "+w[1]}if(z.test(C.innerHTML)){x="(\u597d\u53cb)"}else{x="(\u964c\u751f\u4eba)"}C.innerHTML='<i></i><div class="tdog-contact-info"><span class="tdog-popup-contact">'+d.userName+"</span>"+A+"</div>";C.className="tdog-status-"+w[0]},showMsg:function(B){if(!h.isArray(B)){return}var y=h.get("div.tdog-popup-talkhistory",m),x=0,w,A,z;if(h.UA.ie){w='<div class="tdog-popup-tms-bullet tdog-ie"><div class="tdog-lt"></div><div class="tdog-popup-tms-bulletin"></div><div class="tdog-rt"></div></div>'}else{w='<div class="tdog-popup-tms-bullet"><div class="tdog-popup-tms-bulletin"></div></div>'}for(;x<B.length;x++){w=w+this.__getMessageRealContent(B[x])}y.innerHTML+=w;h.later(function(){y.scrollTop=y.scrollHeight},200,false)},showSysTip:function(y,x){if(!m){return}var w;if(x){w=h.get("div.tdog-popup-talkright",m);if(w){t.css(w,"background-image","none");w.innerHTML=y}}else{w=h.get("div.tdog-popup-talkhistory",m);if(w){w.innerHTML+='<div class="tdog-talk-filetip"><i></i>'+y+"</div>";w.scrollTop=w.scrollHeight}}},updateMsg:function(){if(!m){return}var x=h.get("div.tdog-popup-talkhistory",m),w=r.DataManager.getAllMessages(d.userId);x.innerHTML="";r.ChatDialog.showMsg(w);if(j){this.showBulletin(j,m)}},getCurrentChatUserId:function(){if(this.isOpen()){return(d&&d.userId)?d.userId:""}return""},getCurrentChatUserInfo:function(){if(this.isOpen()){return d}return{}},clearCurrentChatUserId:function(){if(d&&d.userId){d.userId=""}},sendMsg:function(w){var y=r.DataManager.getNickName(),z=r.Util.charToFace(w.value,true);this.showMsg([{fromId:this.getCurrentChatUserId(),userId:y,sendTime:r.Util.formatDate(new Date()),content:r.Util.escapeHTML(z),type:r.MESSAGE_TYPE.SELF}]);var x=a.formatNick(d.userId);c.fire(r.EVENTS.SEND_MESSAGE,{userName:x,content:z,callback:{onFailure:function(){r.ChatDialog.showSysTip("<p><span>\u7f51\u7edc\u539f\u56e0\uff0c\u6d88\u606f\u53d1\u9001\u5931\u8d25\uff01</span></p>")},onTimeout:function(){r.ChatDialog.showSysTip("<p><span>\u7f51\u7edc\u8d85\u65f6\uff01</span></p>")}}});w.value=""},changeBut:function(){var w=h.get("div.tdog-popup-talkinput",m).getElementsByTagName("textarea")[0],z=h.get("span.tdog-popup-sendbut",m),y="tdog-popup-sendbut-off",x=w.value;if(x==""){if(!t.hasClass(z,y)){t.addClass(z,y)}}else{if(x!=""){if(t.hasClass(z,y)){t.removeClass(z,y)}}}},_bindUI:function(L){var x=h.get("span.tdog-popup-help",L),I=h.get("span.tdog-popup-close",L),G=h.get("a.tdog-popup-pulloff",L),y=h.get("div.tdog-popup-talkright",L),D=h.get("div.tdog-popup-talkleftinner",L),H=h.get("span.tdog-popup-changesend",L),z=h.get("div.tdog-popup-talkbar",L),C=h.get("span.tdog-popup-talkbar-clear",L),K=h.get("div.tdog-popup-talkhistory",L),A=h.get("div.tdog-popup-tms-bulletin",L),E=t.children(z)[0],B=t.next(H),w=B.getElementsByTagName("li"),J=h.get("span.tdog-popup-send",L),F=h.get("div.tdog-popup-talkinput",L).getElementsByTagName("textarea")[0];u.on(L,"click",function(N){var M=N.target;if(M!=E){t.css(s,"display","none")}if(M.className=="tdog-popup-tms-bulletin-close"){h.get("div.tdog-popup-tms-bulletin-close",L).parentNode.parentNode.style.display="none"}});u.on(x,"click",function(){var N=i(r.DataManager.getNickName()),M=i("\u95ee\u9898\u54a8\u8be2");g.open("http://im.robot.aliapp.com/all/aliqzg/webspace.jsp?id=4&userId="+N+"&ask="+M);r.Util.sendLog("wwweblog=checkww")});u.on(C,"click",function(){var M=r.ChatDialog.getCurrentChatUserId();K.innerHTML="";r.DataManager.deleteMessage(M);a.clearChatMessage(M)});u.on(I,"click",function(){L.style.display="none";t.css(s,"display","none");K.innerHTML="";m=false;d=""});u.on(G,"click",function(){if(y.style.display!="none"){k.css([[y,"display","none"],[L,"width",K.offsetWidth+(h.UA.ie?6:2)+"px"],[A,"display","none"],[D,"margin-right","auto"],[K,"width","auto"],[K,"marginRight","6px"]]);t.attr(G,"title","\u663e\u793a\u4fa7\u8fb9\u680f");G.className="tdog-popup-pullon";h.get("div.tdog-popup-handle-y",L).style.height="38%"}else{k.css([[y,"display","block"],[L,"width",L.offsetWidth+147+"px"],[D,"marginRight","145px"]]);y.style.height=parseInt(L.offsetHeight)-37+"px";t.attr(G,"title","\u9690\u85cf\u4fa7\u8fb9\u680f");G.className="tdog-popup-pulloff";h.get("div.tdog-popup-handle-y",L).style.height="95%"}});u.on(J,"click",function(){if(!r.ChatDialog.__checkLength(F.value)){return}this.sendMsg(F);this.changeBut();t.css(B,"display","none")},this,true);u.on(H,"click",function(){if(t.css(B,"display")=="none"){t.css(B,"display","block");t.addClass(L,"tdog-popup-visible");if(h.UA.ie==6){t.css(L,"paddingBottom","0")}}else{t.css(B,"display","none");if(t.hasClass(L,"tdog-popup-visible")){t.removeClass(L,"tdog-popup-visible");if(h.UA.ie==6){t.css(L,"paddingBottom","1px")}}}});u.on(w[0],"click",function(){if(w[0].className==""){w[0].className="tdog-send-mode";w[1].className=""}t.css(B,"display","none")});u.on(w[1],"click",function(){if(w[1].className==""){w[1].className="tdog-send-mode";w[0].className=""}t.css(B,"display","none")});u.on(F,"mousedown",function(M){this.changeBut()},this,true);u.on(F,"paste",function(N){var M=this;g.setTimeout(function(){M.changeBut()},100)},this,true);u.on(F,"keyup",function(){this.changeBut()},this,true);u.on(F,"keydown",function(S){var Q,O=this;if(S==null){return}if(S.ctrlKey&&S.keyCode==13){var R=F.value;if(w[0].className=="tdog-send-mode"){if(!r.ChatDialog.__checkLength(R)){return}this.sendMsg(F)}else{if(v.selection){var N=v.selection.createRange();N.text="\r\n"}else{var M=R.length,P=M-F.selectionEnd;F.value=R.substr(0,F.selectionStart)+"\r\n"+R.substring(F.selectionEnd,M);F.selectionEnd=M-P+1}}}else{if(S.keyCode==13){if(w[1].className=="tdog-send-mode"){S.preventDefault();if(!r.ChatDialog.__checkLength(F.value)){return}this.sendMsg(F)}else{}}}if(S.keyCode==27){O.closeDialog()}},this,true);u.on(E,"click",function(){r.ChatDialog.Face.show(E,F)});u.on(K,"click",function(Q){var M=Q.target;if(M.nodeName.toUpperCase()=="A"&&M.parentNode.className=="webww-msg-unsafe-link"){var N=h.get("div.tdog-popup-talkhistory",m);var O,P=h.get("div.tdog-popup-tips");if(!P){P='<div class="tdog-tips tdog-popup-tips"><div class="tdog-tipscontainer"><i class="tdog-tipsalert"></i><i class="tdog-tipsclose"></i><div class="tdog-tipsmain"><p>\u65e0\u6cd5\u786e\u8ba4\u94fe\u63a5\u7684\u5b89\u5168\u6027\uff0c\u8bf7\u53ea\u6253\u5f00\u6765\u6e90\u53ef\u9760\u7684\u7f51\u5740</p><p><a id="__last__webww_msg_unsafe_link" href="'+M.href+'" target="_blank">\u6253\u5f00\u94fe\u63a5</a>&nbsp;&nbsp;&nbsp;&nbsp;</p></div></div></div>';P=t.create(P);M.parentNode.appendChild(P);if(N.scrollHeight-150>0){P.style.top=N.offsetHeight+N.scrollTop-150+"px"}P.style.zoom=1;O=h.get("i.tdog-tipsclose",P);u.on(O,"click",function(){M.parentNode.removeChild(P)})}else{P.style.top=N.offsetHeight+N.scrollTop-150+"px";h.get("#__last__webww_msg_unsafe_link").href=M.href}Q.preventDefault()}})},__getMessageRealContent:function(y){var w=parseInt(y.type);switch(w){case r.MESSAGE_TYPE.SELF:return this.__talkMessage(y,y.userId,true);case r.MESSAGE_TYPE.OFFLINE:return this.__talkMessage(y,y.fromId);case r.MESSAGE_TYPE.TALK:var x="";var z=parseInt(y.subType);switch(z){case r.MESSAGE_SUBTYPE.FAIL_ACK:x=r.UNSUPPORT_MSG[z].replace("{content}",y.content);break;case r.MESSAGE_SUBTYPE.ILLEGALITY:x=y.content;break;case r.MESSAGE_SUBTYPE.NEED_AUTH:return"";case r.MESSAGE_SUBTYPE.FILE_MESSAGE:case r.MESSAGE_SUBTYPE.PIC_MESSAGE:case r.MESSAGE_SUBTYPE.GRAFFITI:case r.MESSAGE_SUBTYPE.REMOTE_ASSIST:case r.MESSAGE_SUBTYPE.AV:case r.MESSAGE_SUBTYPE.FOLDER:case r.MESSAGE_SUBTYPE.PEER_VERIFY:x=r.UNSUPPORT_MSG[z]+"</br>"+r.ERROR_MESSAGE["-40000"];break;case r.MESSAGE_SUBTYPE.TALK_MESSAGE:return this.__talkMessage(y,y.fromId);case r.MESSAGE_SUBTYPE.AUTO_BACK_TALK_MESSAGE:return this.__talkMessage(y,y.fromId,undefined,true);default:h.log("\u51fa\u73b0\u672a\u5b9a\u4e49\u7684\u6d88\u606f\u7c7b\u578b\uff1a"+y.subType,"warn");return""}return'<div class="tdog-talk-filetip"><i></i><p><span>'+x+"</span></p></div>"}h.log("\u6d88\u606f\u4e2d\u51fa\u73b0\u9519\u8bef:"+w,"warn");return""},__talkMessage:function(z,y,x,A){var w=z.content;w=r.Util.charToFace(z.content,null,x);w=w.replace(/\n/g,"<br />");return'<p class="tdog-talk-others"><span class="tdog-talk-username">'+r.Util.getUserName(y)+'</span><span class="tdog-talk-time">('+z.sendTime+'):</span></p><div class="tdog-talk-content">'+(A?'<span class="tdog-auto-back-talk-message">[\u81ea\u52a8\u56de\u590d]</span>':"")+w+"</div>"},__checkLength:function(C){var y,z,w='<div class="tdog-tips tdog-popup-tips"><div class="tdog-tipscontainer"><s class="tdog-tipsext"></s><i class="tdog-tipsimg"></i><i class="tdog-tipsclose"></i><div class="tdog-tipsmain"><p>\u4f60\u53d1\u9001\u7684\u6d88\u606f\u8fc7\u957f\uff0c\u8bf7\u4e0b\u8f7d\u652f\u6301\u53d1\u9001\u8d85\u957f\u4fe1\u606f\u7684<a href="'+n.downloadWangWangURLBuy+'" target="_blank">\u963f\u91cc\u65fa\u65fa\u5ba2\u6237\u7aef</a></p></div></div></div>',x=h.get("div.tdog-popup-talkcontainer",l);z=0;for(y=0;y<C.length;y++){if((C.charCodeAt(y)>=0)&&(C.charCodeAt(y)<=255)){z=z+1}else{z=z+2}}if(z>300){if(h.query("div.tdog-popup-tips",x).length==1){return}var B=t.create(w),A;x.appendChild(B);A=h.get("i.tdog-tipsclose",B);u.on(A,"click",function(){x.removeChild(B)});return false}else{if(z==0){return false}}return true}};r.ChatDialog.Face={init:function(w){s=v.createElement("div");s.id="tdog-face-container";for(var x=0;x<99;x++){s.innerHTML+='<span data-icon="'+x+'.gif"></span>'}h.get("#tstart").appendChild(s);this._bindUI()},show:function(x,w){if(!s){this.init(w)}else{s.style.display="block"}var y=[t.offset(x).left,t.offset(x).top-237];t.offset(s,{left:y[0],top:y[1]});w.focus()},_bindUI:function(){u.on(s,"click",function(C){var x=h.get("div.tdog-popup-talkinput",m).getElementsByTagName("textarea")[0],w=C.target,B=t.attr(w,"data-icon");B=r.Util.faceToChar(B);x.focus();if(typeof v.selection!="undefined"){v.selection.createRange().text=B}else{var A=x.value,z=A.length,y=z-x.selectionEnd;x.value=A.substr(0,x.selectionStart)+B+A.substring(x.selectionEnd,x.value.length);x.selectionEnd=x.value.length-y}s.style.display="none";r.ChatDialog.changeBut()})}}});TDog.add("StatusIcon",function(b){var d=KISSY,e=d.DOM,c,a=0;b.StatusIcon={init:function(){d.log("init StatusIcon");c=d.get("#tstart-plugin-tdog s.tstart-item-icon");this.offline()},onlogin:function(){c.className="tstart-item-icon tstart-tdog-login"},isLogining:function(){return e.hasClass(c,"tstart-tdog-login")},online:function(){if(c.className!="tstart-item-icon tstart-tdog-online"){c.className="tstart-item-icon tstart-tdog-online"}},offline:function(){c.className="tstart-item-icon tstart-tdog-offline"},isOffline:function(){return e.hasClass(c,"tstart-tdog-offline")},getmessage:function(){if(c.className!="tstart-item-icon tstart-tdog-mess"){c.className="tstart-item-icon tstart-tdog-mess"}},onNewMessage:function(){return e.hasClass(c,"tstart-tdog-mess")},showcount:function(f){if(a===f){return}if(f==0){c.innerHTML="";this.online()}else{c.innerHTML='<span class="tdog-toolbar-msgnum">'+f+"</span>";this.getmessage()}a=f},removeicon:function(){c.className="tstart-item-icon"}}});TDog.add("SysMessage",function(h){var e=KISSY,j=e.DOM,i=e.Event,d,b,c,g="none",a="block",f='<div id="tdog-sys-message" class="tdog-simplepop" style="display:none;"><div class="tdog-simplepop-head"><span>\u7cfb\u7edf\u6d88\u606f</span><span class="tdog-closebut"></span></div><div class="tdog-simplepop-main"><div class="tdog-sysinfo"><dl></dl></div><div class="tdog-sysinfo-foot"></div></div></div>';h.SysMessage={init:function(){},_create:function(){d=j.create(f);e.get("#tstart").appendChild(d);b=e.get("dl",d);this._bindUI()},show:function(k){if(!b){this._create()}this._loadData(k);d.style.display=a},_loadData:function(l){l.datetime=l.datetime.split(" ")[0];var k=(l.content||"").replace(/\r\n/ig,"<br />");b.innerHTML='<dt><p><span class="tdog-info-mailicon"></span><span class="tdog-info-title">'+l.title+'</span><span class="tdog-info-time">'+l.datetime+'</span><span class="tdog-info-toolopen"></span></p></dt><dd style="display:none">'+k+"</dd>"+b.innerHTML},_bindUI:function(){i.on("#tdog-sys-message .tdog-closebut","click",function(){d.style.display=g});i.on(b,"click",function(m){var n=m.target,l=n,k;while(l.nodeName!=="DT"&&l!==b){l=l.parentNode}if(l.nodeName==="DT"){if(c&&c!=l&&e.get(".tdog-info-toolclose",c)){e.get(".tdog-info-toolclose",c).className="tdog-info-toolopen";c.nextSibling.style.display=g}k=l.nextSibling;if(k.style.display===a){e.get(".tdog-info-toolclose",l).className="tdog-info-toolopen";k.style.display=g}else{e.get(".tdog-info-toolopen",l).className="tdog-info-toolclose";k.style.display=a}c=l}})}}});TDog.add("SysPopup",function(c){var d=KISSY,e=d.DOM,b=d.Event;POPUP_TEMP='<div class="tdog-simplepop" style="width:225px;"><div class="tdog-simplepop-head"><span class="tdog-simplepop-icon"></span><span>{title}</span><span class="tdog-closebut"></span> </div><div class="tdog-simplepop-main"><div class="tdog-remind"><div class="tdog-remind-inner">{content}</div></div> <div class="tdog-remind-foot"><span>{time}</span></div></div></div>';c.SysPopup={init:function(){var f={content:"\u60a8\u7684\u6dd8\u5b9d\u8ba2\u9605\u6709\u66f4\u65b0<br>\u6d3b\u52a80 \u5546\u54c10 \u5e97\u94fa 0<br>\u67e5\u770b\u66f4\u65b0 \u7ba1\u7406\u8ddf\u65b0",style:"pos=3;width=225;height=150;format=1;staytime=18000001;showmode=0;title=\u7cfb\u7edf\u63d0\u793a;enablemove=0"}},show:function(i){if(!i.content){return}var f={title:"\u6dd8\u5b9d\u65fa\u65fa\u8ba2\u9605\u63d0\u9192",width:"225px",time:new Date(),staytime:60000};if(i.style){var g=d.unparam(i.style,";");f=Y.lang.merge(f,g)}if(i.time){f.time=i.time}f.content=i.content;f.time=c.Util.formatDate(f.time);var h=e.create(a(POPUP_TEMP,f));d.get("#tstart").appendChild(h);this._bindUI(h);window.setTimeout(function(){if(h){d.get("#tstart").removeChild(h)}},f.staytime)},_bindUI:function(g){var f=d.get("span.tdog-closebut",g);b.on(f,"click",function(h){d.get("#tstart").removeChild(g)})}};function a(f,g){return f.replace(/\{([^}]+)\}/g,function(h,i){return g[i]||""})}});TDog.add("SysTips",function(k){var c=KISSY,m=c.DOM,l=c.Event,a,d,j,e="tstart-item-hover-tips",b="tstart-hidden",f="tstart-tips-login-ok-btn",n="tstart-client-oneline",g="tstart-client-cancle-oneline",h="tstart-client-help-oneline",i='<span class="tstart-item-tips tdog-systips tstart-hidden"><i></i><s></s><div class="tdog-systips-content">{CONTENT}</div></span>';k.SysTips={init:function(){c.log("init SysTips");var o=k.hostEl;o.removeChild(c.get(".tstart-item-tips"));d=m.create(i);j=c.get(".tdog-systips-content",d);o.appendChild(d);a=c.get(".tstart-drop-trigger",o);this._bindUI()},show:function(p,q,o){d.style.width=(q||120)+"px";j.innerHTML=p||k.ERROR_MESSAGE[-1];m.removeClass(d,e);m.removeClass(d,b);if(o){c.later("hide",o*1000,false,this,d)}},setHoverTips:function(o){j.innerHTML=o;m.addClass(d,e)},hide:function(){m.addClass(d,b)},_bindUI:function(){var o=this;l.on(d,"click",function(p){var q=p.target;if(m.hasClass(q,f)){k.WebServer.login()}else{if(m.hasClass(q,n)){k.Login.online=true;k.Login.ready=true;k.WebServer.login(k.WebServer.AUTO_LOGIN.forcedLogin);k.Util.sendLog("&wwweblog=confirm")}else{if(m.hasClass(q,h)){window.open("http://im.robot.aliapp.com/all/aliqzg/webspace.jsp?id=4&ask=%E5%AE%89%E8%A3%85%E4%BA%86%E9%98%BF%E9%87%8C%E6%97%BA%E6%97%BA%EF%BC%8C%E7%82%B9%E2%80%9C%E5%92%8C%E6%88%91%E8%81%94%E7%B3%BB%E2%80%9D%E6%9C%AA%E5%BC%B9%E5%87%BA%E8%81%8A%E5%A4%A9%E7%AA%97%E5%8F%A3%EF%BC%9F&page=kjts","")}else{if(m.hasClass(q,g)){k.StatusIcon.offline();k.Util.sendLog("&wwweblog=cancel")}else{if(q.nodeName==="A"&&q.className!="tstart-item-tips-on"){location.href=q.href}else{if(q.nodeName==="A"&&q.className=="tstart-item-tips-on"){window.open(q.href,"")}}}}}}o.hide()})},showLoginTips:function(p){if(p||k.StatusIcon.isLogining()){this.show("\u963f\u91cc\u65fa\u65fa\u6b63\u5728\u767b\u5f55\uff0c\u8bf7\u7a0d\u5019\u2026\u2026",110)}else{var o=k.DataManager.getNickName();this.show("\u548c\u5bf9\u65b9\u804a\u5929\uff0c\u9700\u8981\u767b\u5f55\u963f\u91cc\u65fa\u65fa\uff0c\u786e\u5b9a\u7528\u5e10\u53f7\uff08"+o+'\uff09\u767b\u5f55\u5417\uff1f<hr><span class="tstart-item-tips-btn '+f+'">\u786e\u5b9a</span><span class="tstart-item-tips-btn">\u53d6\u6d88</span>',200)}},showClientOnlineTips:function(){var o=k.DataManager.getNickName(),p="http://im.robot.aliapp.com/all/aliqzg/webspace.jsp?id=4&ask=%E5%AE%89%E8%A3%85%E4%BA%86%E9%98%BF%E9%87%8C%E6%97%BA%E6%97%BA%EF%BC%8C%E7%82%B9%E2%80%9C%E5%92%8C%E6%88%91%E8%81%94%E7%B3%BB%E2%80%9D%E6%9C%AA%E5%BC%B9%E5%87%BA%E8%81%8A%E5%A4%A9%E7%AA%97%E5%8F%A3%EF%BC%9F&page=kjts";this.show("\u60a8\u7684\u5e10\u53f7\uff08"+o+'\uff09\u5df2\u7ecf\u767b\u5f55\u4e86\u963f\u91cc\u65fa\u65fa<br/>1\u3001\u70b9\u51fb\u3010\u786e\u5b9a\u3011\u7ee7\u7eed\u767b\u5f55\u7f51\u9875\u7248,\u767b\u5f55\u6210\u529f\u540e\u4f1a\u628a\u5df2\u767b\u5f55\u7684\u5ba2\u6237\u7aef\u8e22\u4e0b\u7ebf<br>2\u3001\u5982\u679c\u60a8\u5df2\u767b\u5f55\u5ba2\u6237\u7aef,\u70b9\u51fb\u3010\u5e2e\u52a9\u3011,\u83b7\u53d6\u5982\u4f55\u7ee7\u7eed\u4f7f\u7528(\u4fee\u590d)\u5ba2\u6237\u7aef\u7684\u65b9\u6cd5<hr><span class="tstart-item-tips-btn '+n+'">\u786e\u5b9a</span><span class="tstart-item-tips-btn '+g+'">\u53d6\u6d88</span><span class="tstart-item-tips-btn '+h+'">\u5e2e\u52a9</span>',280)},showLoginFailedTips:function(p){var o=k.ERROR_MESSAGE[p]||"\u963f\u91cc\u65fa\u65fa\u6682\u65f6\u4e0d\u53ef\u7528\uff0c\u8bf7\u7a0d\u5019\u518d\u8bd5";this.show(o+'<hr><span class="tstart-item-tips-btn">\u786e\u5b9a</span>',180)},showLogoutTips:function(p){p=p||-1;var o="\u963f\u91cc\u65fa\u65fa\u73b0\u5728\u79bb\u7ebf\u4e86\u3002<hr>\u662f\u5426\u91cd\u65b0\u767b\u5f55\uff1f";if(p=="402"){o="\u4f60\u7684\u5e10\u53f7("+k.DataManager.getNickName()+")\u5df2\u7ecf\u5728\u5176\u4ed6\u5730\u65b9\u767b\u5f55\uff01<hr>\u9700\u8981\u91cd\u65b0\u767b\u5f55\u5417\uff1f"}if(p!=-1){this.show(o+'<br /><span class="tstart-item-tips-btn '+f+'">\u786e\u5b9a</span><span class="tstart-item-tips-btn">\u53d6\u6d88</span>',180)}},showWelcomeTips:function(){this.show("\u6b22\u8fce\u4f7f\u7528\u5168\u65b0\u963f\u91cc\u65fa\u65fa\u7f51\u9875\u7248\uff01",100)},showLastTips:function(){if(!m.hasClass(d,e)){m.removeClass(d,b)}}}});TStart.add("plugin~tdog",function(a){var d=KISSY.DOM,e=a.PLUGIN_TYPE,b=TDog.EVENTS,c=TDog.EventCenter;a.addPlugin("tdog",{type:e.DROP_ITEM,area:"right",text:"",tips:"\u963f\u91cc\u65fa\u65fa",panelTitle:"\u6700\u8fd1\u8054\u7cfb\u4eba",panelHeight:220,panelWidth:160,init:function(){TDog.init(a,this.domEl)},beforeOpenPanel:function(f){if(d.hasClass(f.target,"tstart-item-icon")){return c.fire(b.CLICK_STATUS_ICON)}return false},onOpenPanel:function(f){TDog.EventCenter.fire(TDog.EVENTS.SHOW_RECENT_LIST,f)}})});TStart.add("plugin~settings",function(c){var d=KISSY,e=d.DOM,b=d.Event,g=c.PLUGIN_TYPE,f="tstart-item-active",a=c.Config.isOnline?"taobao.com":"daily.taobao.net";TStart.addPlugin("settings-sep1",{type:g.SEPARATOR});c.addPlugin(["settings"],{type:g.CUSTOM,html:'<span class="tstart-settings-trigger" title="\u8bbe\u7f6e web \u65fa\u65fa"><s></s></span><div class="tstart-settings-panel"><div class="tstart-settings-panel-hd"></div><div class="tstart-settings-panel-bd"><p><input type="checkbox" class="tstart-settings-login"/><label>\u81ea\u52a8\u767b\u5f55</label></p><p><input type="checkbox" class="tstart-settings-msg"/><label>\u63a5\u53d7\u964c\u751f\u4eba\u6d88\u606f</label></p></div></div>',init:function(){var j=e.get("#tstart-plugin-settings"),h=e.get(".tstart-settings-panel",j),l=e.get(".tstart-settings-login",j),k=e.get("#tstart-plugin-tdog"),i=e.get(".tstart-settings-msg",j);b.on(j,"click",function(m){if(!e.hasClass(f)){TDog.WebServer.checkUserSeting()}if(e.hasClass(k,f)){e.removeClass(k,f)}e.toggleClass(j,f);m.stopPropagation()});b.on(h,"click",function(m){m.stopPropagation()});b.on(document,"click",function(){e.removeClass(j,f)});b.on(l,"click",function(){var m=-1;if(l.checked){m=2}else{m=1}TDog.WebServer.setAutoLogin(m)});b.on(i,"click",function(){var m=-1;if(i.checked){m=3}else{m=4}TDog.WebServer.setStrangerMsg(m)})}})});TStart.add("core~deploy",function(b){var c=KISSY,a=c.Cookie,d={pickDomain:function(g,h){h=h||location.hostname;var i=".",f=h.split(i),e=f.length;if(e<=2){return h}g=g||1;if(g>e-2){g=e-2}return f.slice(g).join(i)}};c.ready(function(l){c.log("\u5f00\u59cb\u90e8\u7f72\u6dd8\u5b9d\u5de5\u5177\u6761");var k="x",p=location,i=c.merge({e:0,p:"*",s:0,c:0,f:0,g:0,t:0},c.unparam(a.get(k))),n=window.g_config||{},e=c.unparam(location.search.substring(1)),t=(n.appId===l)?-1:parseInt(n.appId,10),f=unescape((a.get("_nk_")||"").replace(/\\u/g,"%u")),q=a.get("_l_g_")&&f,s="\u98ce\u6e05\u626c,\u94c1\u6728\u771f,\u900d\u9065\u5b50,\u4e8c\u5f53\u5bb6,\u65e0\u5d16\u5b50,\u4ee4\u72d0\u51b2,\u9b3c\u811a\u4e03,\u6b65\u60ca\u4e91,\u4e0a\u5b98\u71d5,\u963f\u9aa8\u6253,\u957f\u5b59\u6cf0,\u516c\u5b59\u5b8f,\u6b27\u9633\u6e05,\u6b27\u9633\u73e0,\u4e0a\u5b98\u7ea8,\u53e4\u897f\u98ce,\u5954\u96f7\u624b,\u516c\u7f8a\u7fbd",h=d.pickDomain(2),j=/daily/i,g=!(j.test(location.host)),r=function(){a.set(k,c.param(i),365,h,"/")},m=function(w,y){w=encodeURIComponent(w+"");if(!(w=c.trim(w))){return false}var v=0,x=0,u=w.length;for(;x<u;x++){v+=w.charCodeAt(x)}return v%10<y},o;TStart.store=new c.SWFStore("http://"+(g?"a.tbcdn.cn":"assets.daily.taobao.net")+"/p/tstart/1.0/libs/swfstore.swf?t="+new Date().getTime());i.e=1;i.p="*";r();b.init();o=window.top||window.parent;if(o&&o!=window){c.DOM.css("#tstart","display","none")}})});
